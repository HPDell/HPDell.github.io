<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>Microsoft Machine Learning Server 使用调研 | 我们在小孩和大人的转角盖一座城堡</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="hpdell"><meta name="designer" content="minfive"><meta name="keywords" content="undefined"><meta name="description" content="HPDell 的博客"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://hpdell.github.io/编程/microsoft-machine-learning-server/index.html"><link rel="icon" type="image/png" href="/assets/img/avatar.jpg" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="HPDell 的个人博客"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart=""><div id="page-loading" class="page page-loading" style="background-image:url(undefined)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="HPDell 的个人博客" alt="HPDell 的个人博客"><img src="/assets/img/avatar.jpg" alt="HPDell 的个人博客"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="/assets/img/header_cover.jpg" alt="Microsoft Machine Learning Server 使用调研"></div><header class="post__info"><h1 class="post__title">Microsoft Machine Learning Server 使用调研</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/">HPDell</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2019-03-04</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/R/">R</a></li></ul></div></div></header><div class="post__content"><h1 id="Machine-Learning-Server-主要功能"><a href="#Machine-Learning-Server-主要功能" class="headerlink" title="Machine Learning Server 主要功能"></a>Machine Learning Server 主要功能</h1><p>Micorosft Machine Learning Server 前身就是 Microsoft R Server ，加入了 Python 支持后更名。主要用于数据分析模型的商业化使用，并提供分布式、并行等计算功能。</p><p>支持以下平台：</p><ul><li>Windows</li><li>Hadoop</li><li>Linux</li></ul><p>Machine Learning Server 主要提供以下功能：</p><table><thead><tr><th>功能</th><th>R</th><th>Python</th></tr></thead><tbody><tr><td><strong>在 Machine Learning Server 中运行 R 代码</strong></td><td>o</td><td></td></tr><tr><td>使用 RevoScalePy 创建 Python 代码</td><td></td><td>o</td></tr><tr><td>使用 MicrosoftML 进行二分分类</td><td></td><td>o</td></tr><tr><td><strong>将模型作为 Web 服务发布</strong></td><td>o</td><td>o</td></tr></tbody></table><p>Machine Learning Server 的特性：</p><ul><li>无论您的数据存在于何处，都可以获得高性能的机器学习</li><li>微软和开源的最佳人工智能创新</li><li>简单，安全，高规模的操作和管理</li><li>深入的生态系统参与，以最佳的总体拥有成本实现客户成功</li></ul><p>Machine Learning Server 的使用是与 <strong>Microsoft R Client</strong> 结合进行的。Microsoft R Client 相当于一个 R 的发行版，内置了一些专用的函数，可以进行远程运行代码以及发布 Web 服务。</p><h1 id="RevoScaleR-库"><a href="#RevoScaleR-库" class="headerlink" title="RevoScaleR 库"></a>RevoScaleR 库</h1><p>提供了一系列 <code>rx</code> 开头的函数，这些函数可以与 Machine Learning Server 结合运行。</p><h2 id="数据处理"><a href="#数据处理" class="headerlink" title="数据处理"></a>数据处理</h2><p><code>rxImport</code> 从文本文件、 SAS 、 SPSS 、 SQL Server 、 Teradata 或 ODBC 连接导入数据。原生的数据类型是 XDF 格式。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">inDataFile &lt;- file.path(rxGetOption(<span class="string">"sampleDataDir"</span>), <span class="string">"mortDefaultSmall2000.csv"</span>)</span><br><span class="line">mortOutput &lt;- <span class="literal">NULL</span></span><br><span class="line">mortData &lt;- rxImport(inData = inDataFile, outFile = mortOutput)</span><br></pre></td></tr></table></figure><blockquote><p><strong><em>关于 Machine Learning Server中的数据存储</em></strong></p><p>在 Machine Learning Server 中，您可以将内存数据用作数据框，或将其作为 XDF 文件保存到磁盘。如上所述， <code>rxImport</code> 可以使用或不使用 .xdf 文件创建数据源对象。如果省略 <code>outFile</code> 参数或将其设置为 <code>NULL</code>，则返回对象是包含数据的数据框。</p><p>数据框是 R 中的基本数据结构，在机器学习服务器中完全支持。它是表格，由行和列组成，其中列包含变量，第一行（称为标题）存储列名。后续行为与单个观察相关联的每个变量提供数据值。数据框是在加载某些数据时创建的临时数据结构。它仅在会话期间存在。</p><p>.xdf 文件是 Machine Learning Server 本机的二进制文件格式，用于在磁盘上保存数据。 .xdf 文件的组织是基于列的，每个变量一列，这对于统计和预测分析中使用的数据的可变方向是最佳的。使用 .xdf ，您可以加载数据的子集以进行目标分析。此外， .xdf 文件包括可立即使用的预先计算的元数据，无需额外处理。</p><p>不需要创建 .xdf ，但是当数据集很大或很复杂时， .xdf 文件可以通过压缩数据和将数据分配到可以独立读取和刷新的块来提供帮助。此外，在像 Hadoop 的 HDFS 这样的分布式文件系统上， XDF 文件可以将数据存储在多个物理文件中以容纳非常大的数据集。</p></blockquote><p><code>rxGetInfo</code> 一次快速获取有关数据集及其变量的信息，包括有关变量类型和范围的更多信息。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">rxGetInfo(mortData, getVarInfo = <span class="literal">TRUE</span>, numRows=<span class="number">3</span>)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># Data frame: mortData</span></span><br><span class="line"><span class="comment"># Data frame: mortData</span></span><br><span class="line"><span class="comment"># Number of observations: 10000</span></span><br><span class="line"><span class="comment"># Number of variables: 6</span></span><br><span class="line"><span class="comment"># Variable information:</span></span><br><span class="line"><span class="comment"># Var 1: creditScore, Type: integer, Low/High: (486, 895)</span></span><br><span class="line"><span class="comment"># Var 2: houseAge, Type: integer, Low/High: (0, 40)</span></span><br><span class="line"><span class="comment"># Var 3: yearsEmploy, Type: integer, Low/High: (0, 14)</span></span><br><span class="line"><span class="comment"># Var 4: ccDebt, Type: integer, Low/High: (0, 12275)</span></span><br><span class="line"><span class="comment"># Var 5: year, Type: integer, Low/High: (2000, 2000)</span></span><br><span class="line"><span class="comment"># Var 6: default, Type: integer, Low/High: (0, 1)</span></span><br><span class="line"><span class="comment"># Data (3 rows starting with row 1):</span></span><br><span class="line"><span class="comment">#   creditScore houseAge yearsEmploy ccDebt year default</span></span><br><span class="line"><span class="comment"># 1 691 16 9 6725 2000 0</span></span><br><span class="line"><span class="comment"># 2 691 4 4 5077 2000 0</span></span><br><span class="line"><span class="comment"># 3 743 18 3 3080 2000 0</span></span><br></pre></td></tr></table></figure><p><code>rxDataStep</code> 为大多数数据操作任务提供了一个框架。 它允许行选择（rowSelection参数），变量选择（varsToKeep或varsToDrop参数），以及从现有变量创建新变量（变换参数）。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">outFile2 &lt;- <span class="literal">NULL</span></span><br><span class="line">mortDataNew &lt;- rxDataStep(</span><br><span class="line">	<span class="comment"># Specify the input data set</span></span><br><span class="line">	inData = mortData,</span><br><span class="line">	<span class="comment"># Put in a placeholder for an output file</span></span><br><span class="line">	outFile = outFile2,</span><br><span class="line">	<span class="comment"># Specify any variables to keep or drop</span></span><br><span class="line">	varsToDrop = c(<span class="string">"year"</span>),</span><br><span class="line">	<span class="comment"># Specify rows to select</span></span><br><span class="line">	rowSelection = creditScore &lt; <span class="number">850</span>,</span><br><span class="line">	<span class="comment"># Specify a list of new variables to create</span></span><br><span class="line">	transforms = list(</span><br><span class="line">		catDebt = cut(ccDebt, breaks = c(<span class="number">0</span>, <span class="number">6500</span>, <span class="number">13000</span>),</span><br><span class="line">			labels = c(<span class="string">"Low Debt"</span>, <span class="string">"High Debt"</span>)),</span><br><span class="line">		lowScore = creditScore &lt; <span class="number">625</span>))</span><br></pre></td></tr></table></figure><p>数据分析</p><p><code>rxSummary</code> 计算变量的表属性统计信息</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">rxSummary(~ ArrDelay, data = airXdfData)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment">#		Call:</span></span><br><span class="line"><span class="comment">#		rxSummary(formula = ~ArrDelay, data = airXdfData)</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#		Summary Statistics Results for: ~ArrDelay</span></span><br><span class="line"><span class="comment">#		Data: airXdfData (RxXdfData Data Source)</span></span><br><span class="line"><span class="comment">#		File name: airExample.xdf</span></span><br><span class="line"><span class="comment">#		Number of valid observations: 6e+05</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#		Name     Mean     StdDev   Min Max  ValidObs MissingObs</span></span><br><span class="line"><span class="comment">#		ArrDelay 11.31794 40.68854 -86 1490 582628   17372</span></span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">rxSummary(formula = ~ArrDelay + CRSDepTime + DayOfWeek, data = airDS)</span><br><span class="line"><span class="comment"># 输出</span></span><br><span class="line"><span class="comment"># Summary Statistics Results for: ~ArrDelay + CRSDepTime + DayOfWeek</span></span><br><span class="line"><span class="comment"># Data: airXdfData (RxXdfData Data Source)</span></span><br><span class="line"><span class="comment"># File name: C:\Users\TEMP\airExample.xdf</span></span><br><span class="line"><span class="comment"># Number of valid observations: 6e+05</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#  Name       Mean     StdDev    Min        Max        ValidObs MissingObs</span></span><br><span class="line"><span class="comment">#  ArrDelay   11.31794 40.688536 -86.000000 1490.00000 582628   17372     </span></span><br><span class="line"><span class="comment">#  CRSDepTime 13.48227  4.697566   0.016667   23.98333 600000       0     </span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment"># Category Counts for DayOfWeek</span></span><br><span class="line"><span class="comment"># Number of categories: 7</span></span><br><span class="line"><span class="comment"># Number of valid observations: 6e+05</span></span><br><span class="line"><span class="comment"># Number of missing observations: 0</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#  DayOfWeek Counts</span></span><br><span class="line"><span class="comment">#  Monday    97975</span></span><br><span class="line"><span class="comment">#  Tuesday   77725</span></span><br><span class="line"><span class="comment">#  Wednesday 78875</span></span><br><span class="line"><span class="comment">#  Thursday  81304</span></span><br><span class="line"><span class="comment">#  Friday    82987</span></span><br><span class="line"><span class="comment">#  Saturday  86159</span></span><br><span class="line"><span class="comment">#  Sunday    94975</span></span><br></pre></td></tr></table></figure><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">rxSummary(~ArrDelay:DayOfWeek, data=airXdfData)</span><br><span class="line"><span class="comment"># Call:</span></span><br><span class="line"><span class="comment"># rxSummary(formula = ~ArrDelay:DayOfWeek, data=airXdfData)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Summary Statistics Results for: ~ArrDelay:DayOfWeek</span></span><br><span class="line"><span class="comment"># File name: C:\Users\TEMP\airExample.xdf</span></span><br><span class="line"><span class="comment"># Number of valid observations: 6e+05</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  Name               Mean     StdDev   Min Max  ValidObs MissingObs</span></span><br><span class="line"><span class="comment">#  ArrDelay:DayOfWeek 11.31794 40.68854 -86 1490 582628   17372     </span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Statistics by category (7 categories):</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  Category                         DayOfWeek Means    StdDev  Min Max ValidObs</span></span><br><span class="line"><span class="comment">#  ArrDelay for DayOfWeek=Monday    Monday    12.025604 40.02463 -76 1017 95298   </span></span><br><span class="line"><span class="comment">#  ArrDelay for DayOfWeek=Tuesday   Tuesday   11.293808 43.66269 -70 1143 74011   </span></span><br><span class="line"><span class="comment">#  ArrDelay for DayOfWeek=Wednesday Wednesday 10.156539 39.58803 -81 1166 76786   </span></span><br><span class="line"><span class="comment">#  ArrDelay for DayOfWeek=Thursday  Thursday   8.658007 36.74724 -58 1053 79145   </span></span><br><span class="line"><span class="comment">#  ArrDelay for DayOfWeek=Friday    Friday    14.804335 41.79260 -78 1490 80142   </span></span><br><span class="line"><span class="comment">#  ArrDelay for DayOfWeek=Saturday  Saturday  11.875326 45.24540 -73 1370 83851   </span></span><br><span class="line"><span class="comment">#  ArrDelay for DayOfWeek=Sunday    Sunday    10.331806 37.33348 -86 1202 93395</span></span><br></pre></td></tr></table></figure><p><code>rxLinMod</code> 线性回归</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">arrDelayLm2 &lt;- rxLinMod(ArrDelay ~ DayOfWeek, data = airXdfData,</span><br><span class="line">	                    cube = <span class="literal">TRUE</span>)</span><br><span class="line">summary(arrDelayLm2)</span><br><span class="line"><span class="comment"># Call:</span></span><br><span class="line"><span class="comment"># rxLinMod(formula = ArrDelay ~ DayOfWeek, data = airXdfData, cube = TRUE)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Cube Linear Regression Results for: ArrDelay ~ DayOfWeek</span></span><br><span class="line"><span class="comment"># File name: C:\Users\Temp\airExample.xdf</span></span><br><span class="line"><span class="comment"># Dependent variable(s): ArrDelay</span></span><br><span class="line"><span class="comment"># Total independent variables: 7</span></span><br><span class="line"><span class="comment"># Number of valid observations: 582628</span></span><br><span class="line"><span class="comment"># Number of missing observations: 17372</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Coefficients:</span></span><br><span class="line"><span class="comment">#                     Estimate Std. Error t value Pr(&gt;|t|)     | Counts</span></span><br><span class="line"><span class="comment"># DayOfWeek=Monday     12.0256     0.1317   91.32 2.22e-16 *** |  95298</span></span><br><span class="line"><span class="comment"># DayOfWeek=Tuesday    11.2938     0.1494   75.58 2.22e-16 *** |  74011</span></span><br><span class="line"><span class="comment"># DayOfWeek=Wednesday  10.1565     0.1467   69.23 2.22e-16 *** |  76786</span></span><br><span class="line"><span class="comment"># DayOfWeek=Thursday    8.6580     0.1445   59.92 2.22e-16 *** |  79145</span></span><br><span class="line"><span class="comment"># DayOfWeek=Friday     14.8043     0.1436  103.10 2.22e-16 *** |  80142</span></span><br><span class="line"><span class="comment"># DayOfWeek=Saturday   11.8753     0.1404   84.59 2.22e-16 *** |  83851</span></span><br><span class="line"><span class="comment"># DayOfWeek=Sunday     10.3318     0.1330   77.67 2.22e-16 *** |  93395</span></span><br><span class="line"><span class="comment"># ---</span></span><br><span class="line"><span class="comment"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Residual standard error: 40.65 on 582621 degrees of freedom</span></span><br><span class="line"><span class="comment"># Multiple R-squared: 0.001869 (as if intercept included)</span></span><br><span class="line"><span class="comment"># Adjusted R-squared: 0.001858</span></span><br><span class="line"><span class="comment"># F-statistic: 181.8 on 6 and 582621 DF,  p-value: &lt; 2.2e-16</span></span><br><span class="line"><span class="comment"># Condition number: 1</span></span><br></pre></td></tr></table></figure><p><code>rxCrossTabs</code> 数据交叉表</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">myTab &lt;- rxCrossTabs(ArrDelay~DayOfWeek, data = airLateDS)</span><br><span class="line">summary(myTab, output = <span class="string">"means"</span>)</span><br><span class="line"><span class="comment"># Call:</span></span><br><span class="line"><span class="comment"># rxCrossTabs(formula = ArrDelay ~ DayOfWeek, data = airLateDS)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Cross Tabulation Results for: ArrDelay ~ DayOfWeek</span></span><br><span class="line"><span class="comment"># File name: C:\YourWorkingDir\ADS1.xdf</span></span><br><span class="line"><span class="comment"># Dependent variable(s): ArrDelay</span></span><br><span class="line"><span class="comment"># Number of valid observations: 148526</span></span><br><span class="line"><span class="comment"># Number of missing observations: 0</span></span><br><span class="line"><span class="comment"># Statistic: means</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ArrDelay (means):</span></span><br><span class="line"><span class="comment">#               means  means %</span></span><br><span class="line"><span class="comment"># Monday    56.94491 13.96327</span></span><br><span class="line"><span class="comment"># Tuesday   64.28248 15.76249</span></span><br><span class="line"><span class="comment"># Wednesday 60.12724 14.74360</span></span><br><span class="line"><span class="comment"># Thursday  55.07093 13.50376</span></span><br><span class="line"><span class="comment"># Friday    56.11783 13.76047</span></span><br><span class="line"><span class="comment"># Saturday  61.92247 15.18380</span></span><br><span class="line"><span class="comment"># Sunday    53.35339 13.08261</span></span><br><span class="line"><span class="comment"># Col Mean  57.96692</span></span><br></pre></td></tr></table></figure><p><code>rxLogit</code> Logistic 回归</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">logitObj &lt;- rxLogit(Late~DepHour + Night, data = airExtraDS)</span><br><span class="line">summary(logitObj)</span><br><span class="line"><span class="comment"># Call:</span></span><br><span class="line"><span class="comment"># rxLogit(formula = Late ~ DepHour + Night, data = airExtraDS)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Logistic Regression Results for: Late ~ DepHour + Night</span></span><br><span class="line"><span class="comment"># File name: C:\Users\Temp\ADS2.xdf</span></span><br><span class="line"><span class="comment"># Dependent variable(s): Late</span></span><br><span class="line"><span class="comment"># Total independent variables: 3</span></span><br><span class="line"><span class="comment"># Number of valid observations: 582628</span></span><br><span class="line"><span class="comment"># Number of missing observations: 17372</span></span><br><span class="line"><span class="comment"># -2*LogLikelihood: 649607.8613 (Residual deviance on 582625 degrees of freedom)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Coefficients:</span></span><br><span class="line"><span class="comment">#               Estimate Std. Error z value Pr(&gt;|z|)    </span></span><br><span class="line"><span class="comment"># (Intercept) -2.0990076  0.0104460 -200.94 2.22e-16 ***</span></span><br><span class="line"><span class="comment"># DepHour      0.0790215  0.0007671  103.01 2.22e-16 ***</span></span><br><span class="line"><span class="comment"># Night       -0.3027030  0.0109914  -27.54 2.22e-16 ***</span></span><br><span class="line"><span class="comment"># ---</span></span><br><span class="line"><span class="comment"># Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Condition number of final variance-covariance matrix: 3.0178</span></span><br><span class="line"><span class="comment"># Number of iterations: 4</span></span><br></pre></td></tr></table></figure><p><code>rxPredict</code> 预测</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">predictDS &lt;- rxPredict(modelObject = logitObj, data = airExtraDS,</span><br><span class="line">                       outData = airExtraDS)</span><br><span class="line">rxGetInfo(predictDS, getVarInfo=<span class="literal">TRUE</span>, numRows=<span class="number">5</span>)</span><br><span class="line"><span class="comment"># File name: C:\Users\Temp\ADS2.xdf</span></span><br><span class="line"><span class="comment"># Number of observations: 6e+05</span></span><br><span class="line"><span class="comment"># Number of variables: 7</span></span><br><span class="line"><span class="comment"># Number of blocks: 2</span></span><br><span class="line"><span class="comment"># Compression type: zlib</span></span><br><span class="line"><span class="comment"># Variable information:</span></span><br><span class="line"><span class="comment"># Var 1: ArrDelay, Type: integer, Low/High: (-86, 1490)</span></span><br><span class="line"><span class="comment"># Var 2: CRSDepTime, Type: numeric, Storage: float32, Low/High: (0.0167, 23.9833)</span></span><br><span class="line"><span class="comment"># Var 3: DayOfWeek</span></span><br><span class="line"><span class="comment">#        7 factor levels: Monday Tuesday Wednesday Thursday Friday Saturday Sunday</span></span><br><span class="line"><span class="comment"># Var 4: Late, Type: logical, Low/High: (0, 1)</span></span><br><span class="line"><span class="comment"># Var 5: DepHour, Type: integer, Low/High: (0, 23)</span></span><br><span class="line"><span class="comment"># Var 6: Night, Type: logical, Low/High: (0, 1)</span></span><br><span class="line"><span class="comment"># Var 7: Late_Pred, Type: numeric, Low/High: (0.0830, 0.3580)</span></span><br><span class="line"><span class="comment"># Data (5 rows starting with row 1):</span></span><br><span class="line"><span class="comment">#   ArrDelay CRSDepTime DayOfWeek  Late DepHour Night Late_Pred</span></span><br><span class="line"><span class="comment"># 1        6   9.666666    Monday FALSE       9 FALSE 0.1997569</span></span><br><span class="line"><span class="comment"># 2       -8  19.916666    Monday FALSE      19 FALSE 0.3548931</span></span><br><span class="line"><span class="comment"># 3       -2  13.750000    Monday FALSE      13 FALSE 0.2550745</span></span><br><span class="line"><span class="comment"># 4        1  11.750000    Monday FALSE      11 FALSE 0.2262214</span></span><br><span class="line"><span class="comment"># 5       -2   6.416667    Monday FALSE       6 FALSE 0.1645331</span></span><br></pre></td></tr></table></figure><h3 id="数据可视化"><a href="#数据可视化" class="headerlink" title="数据可视化"></a>数据可视化</h3><p>R 中常用的可视化函数都有对应的 rx 版本。</p><p><code>rxHistogram</code> 绘制直方图</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rxHistogram(~ArrDelay|DayOfWeek,  data = airXdfData)</span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/编程/microsoft-machine-learning-server/image2.png"><p><code>rxLinePlot</code> 绘制折线图</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rxLinePlot(ArrDelay~DayOfWeek, data = countsDF,</span><br><span class="line">	       main = <span class="string">"Average Arrival Delay by Day of Week"</span>)</span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/编程/microsoft-machine-learning-server/dayofweek_plot.png"><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rxLinePlot(ArrDelay~CRSDepTime|DayOfWeek, data = arrDelayDT,</span><br><span class="line">	       title = <span class="string">"Average Arrival Delay by Day of Week by Departure Hour"</span>)</span><br></pre></td></tr></table></figure><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/编程/microsoft-machine-learning-server/crsdeptime_plot.png"><h1 id="在-Machine-Learning-Server-中运行-R-代码"><a href="#在-Machine-Learning-Server-中运行-R-代码" class="headerlink" title="在 Machine Learning Server 中运行 R 代码"></a>在 Machine Learning Server 中运行 R 代码</h1><h2 id="计算上下文"><a href="#计算上下文" class="headerlink" title="计算上下文"></a>计算上下文</h2><p>在 Machine Learning Server 中，计算上下文是指处理给定工作负载的计算引擎的物理位置。 默认为本地。 但是，如果您有多台计算机，则可以从本地切换到远程，将以数据为中心的RevoScaleR（R），revoscalepy（Python），MicrosoftML（R）和microsoftml（Python）函数的执行推送到另一个系统上的计算引擎。 例如，在R Client中本地运行的脚本可以将执行转移到Spark集群中的远程机器学习服务器以在那里处理数据。</p><table><thead><tr><th>上下文</th><th>说明</th></tr></thead><tbody><tr><td>local</td><td>所有平台上的所有产品（包括R Client）均支持默认值。 脚本使用本地计算机资源在本地解释器上执行。</td></tr><tr><td>remote</td><td>专门针对选定数据平台上的机器学习服务器：Spark over Hadoop分布式文件系统（HDFS）和SQL Server。 客户端或以客户端身份运行的服务器可以启动远程计算上下文，但目标远程计算机本身必须是Machine Learning Server安装。</td></tr></tbody></table><p>RevoScaleR 的上下文包括：</p><table><thead><tr><th>上下文</th><th>别名</th><th>用法</th></tr></thead><tbody><tr><td><code>RxLocalSeq</code></td><td>local</td><td>所有服务器和客户端配置都支持本地计算上下文。</td></tr><tr><td><code>RxSpark</code></td><td>spark</td><td>远程计算上下文。 目标是Hadoop上的Spark集群。</td></tr><tr><td><code>RxInSqlServer</code></td><td>sqlserver</td><td>远程计算上下文。 目标服务器是单个数据库会话（SQL Server 2016 R服务或SQL Server 2017机器学习服务）。 计算是平行的，但不是分布式的。</td></tr><tr><td><code>RxLocalParallel</code></td><td>localpar</td><td>计算上下文通常用于依靠您提供的指令而不是Hadoop上的内置调度程序来启用受控的分布式计算。 您可以将计算上下文用于手动分布式计算。</td></tr><tr><td><code>RxForeachDoPar</code></td><td>dopar</td><td>用于手动分布式计算。</td></tr></tbody></table><p>上下文支持的数据格式</p><table><thead><tr><th style="text-align:left">Data Source</th><th style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxlocalseq" target="_blank" rel="noopener"><code>RxLocalSeq</code></a></th><th style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxspark" target="_blank" rel="noopener"><code>RxSpark</code></a></th><th style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxinsqlserver" target="_blank" rel="noopener"><code>RxInSqlServer</code></a></th></tr></thead><tbody><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxtextdata" target="_blank" rel="noopener"><code>RxTextData</code></a></td><td style="text-align:left">X</td><td style="text-align:left">X</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxxdfdata" target="_blank" rel="noopener"><code>RxXdfData</code></a></td><td style="text-align:left">X</td><td style="text-align:left">X</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxsparkdata" target="_blank" rel="noopener"><code>RxHiveData</code></a></td><td style="text-align:left">X</td><td style="text-align:left">X</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxsparkdata" target="_blank" rel="noopener"><code>RxParquetData</code></a></td><td style="text-align:left">X</td><td style="text-align:left">X</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxsparkdata" target="_blank" rel="noopener"><code>RxOrcData</code></a></td><td style="text-align:left">X</td><td style="text-align:left">X</td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxodbcdata" target="_blank" rel="noopener"><code>RxOdbcData</code></a></td><td style="text-align:left">X</td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxsqlserverdata" target="_blank" rel="noopener"><code>RxSqlServerData</code></a></td><td style="text-align:left">X</td><td style="text-align:left"></td><td style="text-align:left">X</td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxsasdata" target="_blank" rel="noopener"><code>RxSasData</code></a></td><td style="text-align:left">X</td><td style="text-align:left"></td><td style="text-align:left"></td></tr><tr><td style="text-align:left"><a href="https://docs.microsoft.com/zh-cn/machine-learning-server/r-reference/revoscaler/rxspssdata" target="_blank" rel="noopener"><code>RxSpssData</code></a></td><td style="text-align:left">X</td><td style="text-align:left"></td></tr></tbody></table><p>当数据本身发生变化时，适用于切换上下文。计算应该都是在本地进行的，只是获取数据的上下文发生了改变。</p><h2 id="远程执行-R-代码"><a href="#远程执行-R-代码" class="headerlink" title="远程执行 R 代码"></a>远程执行 R 代码</h2><p>远程执行是从机器学习服务器（或R服务器）或R客户端向另一个机器学习服务器实例上运行的远程会话发出R命令的能力。 您可以使用远程执行来卸载服务器上的繁重处理并测试您的工作。 在开发和测试分析时，它尤其有用。</p><p>远程执行支持以下几种方式：</p><ul><li>在控制台应用程序中从命令行执行</li><li>在 R 脚本中通过调用 mrsdeply 包的函数执行</li><li>通过调用 API 的代码执行</li></ul><p>远程执行可以实现的功能：</p><ul><li>登陆和登出 Machine Learning Server</li><li>生成本地和远程环境的差异报告，并协调任何差异</li><li>远程执行 R 脚本或代码</li><li>远程使用 R 对象或文件工作</li><li>创建和管理远程环境的快照以供重用</li></ul><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/编程/microsoft-machine-learning-server/remote-execution.png"><p>远程执行的函数：</p><ul><li><code>remoteExecute</code> 用于在远程R会话中执行R代码块或R脚本的基本功能。</li><li><code>remoteScript</code> 一个简单的包装函数，用于执行远程R脚本。</li><li><code>diffLocalRemote</code> 在本地和远程之间生成“差异”报告。</li></ul><h3 id="创建远程会话"><a href="#创建远程会话" class="headerlink" title="创建远程会话"></a>创建远程会话</h3><p>使用 mrsdeploy 包的登录函数 <code>remoteLogin()</code> 或 <code>remoteLoginAAD()</code> 在 Machine Learning Server 上进行验证。设置 <code>session = TRUE</code> 创建远程会话，并设置 <code>commandline = TRUE</code> 进入远程控制台。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">remoteLogin(<span class="string">"http://localhost:12800"</span>, </span><br><span class="line">            username = <span class="string">"admin"</span>, </span><br><span class="line">            password = <span class="string">"&#123;&#123;YOUR_PASSWORD&#125;&#125;"</span>,</span><br><span class="line">            diff = <span class="literal">TRUE</span>,</span><br><span class="line">            session = <span class="literal">TRUE</span>,</span><br><span class="line">            commandline = <span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><p>参数说明：</p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td><code>endpoint</code></td><td>Machine Learning Server HTTP / HTTPS端点，包括端口号。 启动管理实用程序时，可以在第一个屏幕上找到此项。</td></tr><tr><td><code>session</code></td><td>如果为 <code>TRUE</code> ，则创建远程会话。 如果省略，则创建远程会话。</td></tr><tr><td><code>diff</code></td><td>如果为 <code>TRUE</code> ，则创建一个“差异”报告，显示本地会话和远程会话之间的差异。 参数仅在会话参数为TRUE时有效。</td></tr><tr><td><code>commandline</code></td><td>如果为 <code>TRUE</code> ，则在R控制台中创建“REMOTE”命令行。参数仅在会话参数为 <code>TRUE</code> 时有效。如果省略，则与 <code>= TRUE</code> 相同。</td></tr><tr><td><code>prompt</code></td><td>用于远程会话的命令提示符。 默认情况下，使用 <code>REMOTE&gt;</code> 。</td></tr><tr><td><code>username</code></td><td>如果为 <code>NULL</code> ，则提示用户输入您的AD或本地计算机学习服务器用户名。</td></tr><tr><td><code>password</code></td><td>如果为 <code>NULL</code> ，则提示用户输入密码。</td></tr></tbody></table><blockquote><p><code>remoteLoginAAD()</code> 函数用于 Azure 云的登录。</p></blockquote><h3 id="在会话间切换或退出"><a href="#在会话间切换或退出" class="headerlink" title="在会话间切换或退出"></a>在会话间切换或退出</h3><p>使用三个函数进行远程会话和本地会话切换，以及退出：</p><ul><li><code>pause()</code> 从远程会话切换到本地会话</li><li><code>resume()</code> 从本地会话切换到远程会话</li><li><code>remoteLogout()</code> 登出 Machine Learning Server</li></ul><p>使用参数 <code>session = TRUE</code> 登录到远程R服务器后，将创建一个远程 R 会话。 您可以直接从命令行在远程 R 会话和本地 R 会话之间切换。 远程命令行允许您直接与另一台计算机上的 R Server 9.x 实例进行交互。</p><p>当R控制台中显示 <code>REMOTE&gt;</code> 命令提示符时，输入的任何R命令都在远程R会话上执行。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/编程/microsoft-machine-learning-server/mrsdeploy-connect-switch-context.png"><p>使用以下函数在本地命令行和远程命令行之间切换：<code>pause()</code> 和 <code>resume()</code>。 要切换回本地 R 会话，请键入“<code>pause()</code>”。 如果已切换到本地R会话，则可以通过键入“ <code>resume()</code>”返回远程 R 会话。</p><p>要终止远程R会话，请在REMOTE&gt;提示符下键入“<code>exit</code>”。 此外，要从本地R会话终止远程会话，请键入“<code>remoteLogout()</code>”。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#EXAMPLE: SESSION SWITCHING </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#execute some R commands on the remote session</span></span><br><span class="line">REMOTE&gt;x&lt;-rnorm(<span class="number">1000</span>)</span><br><span class="line">REMOTE&gt;hist(x)</span><br><span class="line"></span><br><span class="line">REMOTE&gt;pause()  <span class="comment">#switches the user to the local R session</span></span><br><span class="line">&gt;resume()  </span><br><span class="line"></span><br><span class="line">REMOTE&gt;exit  <span class="comment">#logout and terminate the remote R session</span></span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure><h3 id="远程执行-R-脚本"><a href="#远程执行-R-脚本" class="headerlink" title="远程执行 R 脚本"></a>远程执行 R 脚本</h3><p>如果本地计算机上有R脚本，则可以使用 <code>remoteScript()</code>函数远程执行它们。 此函数采用远程执行R脚本的路径。 您还可以选择保存或显示脚本执行期间可能生成的任何图。 该函数返回一个列表，其中包含执行状态（成功/失败），生成的控制台输出以及创建的文件列表。</p><p>如果您的R脚本具有R包依赖项，则必须在 Microsoft R Server 上安装这些包。 您的管理员可以在服务器上全局安装它们，也可以使用 <code>install.packages()</code> 函数在远程会话期间自行安装它们。 将 <code>lib</code> 参数留空。</p><p>远程上下文的限制：</p><ul><li>某些功能在执行时被屏蔽，例如“<code>help</code>”，“<code>browser</code>”，“<code>q</code>”和“<code>quit</code>”。</li><li>在远程上下文中，您无法在命令行提示符下显示晕影或获取帮助。</li><li>在大多数情况下，“<code>system</code>”命令有效。 但是，写入stdout/stderr的系统命令可能不会显示其输出，也不会等到整个系统命令完成后才显示输出。 <code>install.packages</code> 是我们在远程上下文中显式处理 stdout 和 stderr 的唯一例外。</li></ul><p>要在远程脚本执行期间继续在开发环境中工作，可以异步执行 R 脚本。 当您运行具有较长执行时间的脚本时，异步脚本执行非常有用。要异步执行 R 脚本，请将 <code>remoteScript()</code> 的 <code>async</code> 参数设置为 <code>TRUE</code> 。 执行 <code>remoteScript()</code> 时，脚本将在新的远程 R 控制台窗口中异步运行。 所有 R 控制台输出和来自该执行的任何图都返回到同一窗口。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#EXAMPLE: REMOTE SCRIPT EXECUTION </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#install a package for the life of the session</span></span><br><span class="line">REMOTE&gt;install.packages(<span class="string">"bitops"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#switch to the local R session</span></span><br><span class="line">REMOTE&gt;pause()</span><br><span class="line"></span><br><span class="line"><span class="comment">#execute an R script remotely</span></span><br><span class="line">&gt;remoteScript(<span class="string">"C:/myScript.R"</span>)    </span><br><span class="line"></span><br><span class="line"><span class="comment">#execute that script again in another window asynchronously</span></span><br><span class="line">&gt;remoteScript(<span class="string">"C:/myScript.R"</span>, async=<span class="literal">TRUE</span>)</span><br></pre></td></tr></table></figure><h3 id="远程使用R对象和文件"><a href="#远程使用R对象和文件" class="headerlink" title="远程使用R对象和文件"></a>远程使用R对象和文件</h3><p>远程执行R代码后，您可能希望检索某些R对象并将其加载到本地R会话中。 例如，如果您有一个创建线性模型 <code>m &lt;-lm(x~y)</code> 的R脚本，请使用函数 <code>getRemoteObject()</code> 来检索本地R会话中的对象 <code>m</code> 。</p><p>相反，如果您希望远程 R 会话可以使用本地 R 对象，则可以使用函数 <code>putLocalObject()</code> 。 如果要同步本地和远程工作空间，可以使用 <code>putLocalWorkspace()</code> 和 <code>getRemoteWorkspace()</code> 函数。</p><p>类似的功能可用于需要在本地和远程 R 会话之间移动的文件。以下函数可用于处理文件： <code>putLocalFile()</code> 、 <code>getRemoteFile()</code> 、 <code>listRemoteFiles()</code> 和 <code>deleteRemoteFile()</code> 。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#EXAMPLE: REMOTE R OBJECTS AND FILES </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#execute a script remotely that generated 2 R objects we are interested in retrieving</span></span><br><span class="line">&gt;remoteExecute(<span class="string">"C:/myScript.R"</span>)</span><br><span class="line"><span class="comment">#retrieve the R objects from the remote R session and load them into our local R session</span></span><br><span class="line">&gt;getRemoteObject(c(<span class="string">"model"</span>,<span class="string">"out"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#an R script depends upon an R object named `data` to be available. Move the local</span></span><br><span class="line"><span class="comment">#instance of `data` to the remote R session</span></span><br><span class="line">&gt;putLocalObject(<span class="string">"data"</span>)</span><br><span class="line"><span class="comment">#execute an R script remotely</span></span><br><span class="line">&gt;remoteScript(<span class="string">"C:/myScript2.R"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#push a data file to the remote R session</span></span><br><span class="line">&gt;putLocalFile(<span class="string">"C:/data/survey.csv"</span>)</span><br><span class="line"><span class="comment">#execute an R script remotely</span></span><br><span class="line">&gt;remoteScript(<span class="string">"C:/myScript2.R"</span>)</span><br></pre></td></tr></table></figure><h3 id="绘图的注意事项"><a href="#绘图的注意事项" class="headerlink" title="绘图的注意事项"></a>绘图的注意事项</h3><p>远程绘制时，默认绘图大小为400 x 400像素。 如果您需要更高分辨率的输出，则必须告诉远程会话要创建的绘图大小。</p><p>在本地会话中，您可以更改宽度和高度，如下所示：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&gt; png(filename=<span class="string">"myplot.png"</span>, width=<span class="number">1440</span>, height=<span class="number">900</span>)</span><br><span class="line">&gt; ggplot(aes(x=value, group=am, colour=factor(am)), data=mtcarsmelt)   + geom_density() + facet_wrap(~variable, scales=<span class="string">"free"</span>)</span><br><span class="line">&gt; dev.off()</span><br></pre></td></tr></table></figure><p>在处理REMOTE命令行时，您需要将这三个语句组合在一起：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REMOTE&gt; png(filename=<span class="string">"myplot.png"</span>, width=<span class="number">1440</span>, height=<span class="number">900</span>);ggplot(aes(x=value, group=am, colour=factor(am)), data=mtcarsmelt) + geom_density() + facet_wrap(~variable, scales=<span class="string">"free"</span>);dev.off()</span><br></pre></td></tr></table></figure><p>作为替代方法，您可以使用 <code>remoteScript()</code> 函数，如下所示：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#Open a new script window in your IDE</span></span><br><span class="line"><span class="comment">#Enter the commands on separate lines</span></span><br><span class="line"></span><br><span class="line">png(filename=<span class="string">"myplot.png"</span>, width=<span class="number">1440</span>, height=<span class="number">900</span>)</span><br><span class="line">ggplot(aes(x=value, group=am, colour=factor(am)), data=mtcarsmelt) + geom_density() + facet_wrap(~variable, scales=<span class="string">"free"</span>)</span><br><span class="line">dev.off()</span><br></pre></td></tr></table></figure><h1 id="将模型作为-Web-服务发布"><a href="#将模型作为-Web-服务发布" class="headerlink" title="将模型作为 Web 服务发布"></a>将模型作为 Web 服务发布</h1><p><code>mrsdeploy</code> 库提供了一些函数，使 R 模型可以作为 Web 服务发布。</p><h2 id="主要流程"><a href="#主要流程" class="headerlink" title="主要流程"></a>主要流程</h2><ol><li>本地编写模型</li><li>将模型作为 Web 服务发布</li><li>在 R 中使用服务进行测试</li><li>获取基于 Swagger 的 JSON 文件</li><li>基于 Swagger 文件与 Web 服务集成</li></ol><blockquote><p><strong><em>Swagger</em></strong></p><p>大部分 Web 应用程序都支持 RESTful API，但不同于 SOAP API——REST API 依赖于 HTTP 方法，缺少与 Web 服务描述语言（Web Services Description Language，WSDL）类似的语言来定义使用者与提供者之间的请求和响应结构。由于没有充分的合同服务，许多 REST API 提供者使用 Microsoft Word 文档或维基页面来记录 API 用法。这些格式使协作和文档版本控制变得很困难，尤其对于有许多 API 或资源的应用程序，或者在 API 采用迭代式开发方式时。这些文档类型在集成到自动化测试应用程序中时变得更难。</p><p>开源 <a href="http://swagger.io/" target="_blank" rel="noopener">Swagger</a> 框架帮助 API 使用者和开发人员纠正了这些问题。该框架为创建 JSON 或 <a href="http://www.yaml.org/" target="_blank" rel="noopener">YAML</a>（JSON 的一个人性化的超集）格式的 RESTful API 文档提供了 <a href="http://swagger.io/specification/" target="_blank" rel="noopener">OpenAPI 规范</a>（以前称为 Swagger 规范）。Swagger 文档可由各种编程语言处理，可在软件开发周期中签入源代码控制系统中，以便进行版本管理。</p></blockquote><h2 id="发布服务"><a href="#发布服务" class="headerlink" title="发布服务"></a>发布服务</h2><p>服务主要包括<strong>模型</strong>、<strong>代码</strong>两部分，模型即指一些模型对象，如 <code>glm</code> 函数的结果；代码是指调用模型的过程，主要对传输参数进行一些处理。</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># For R Server 9.0, load mrsdeploy package on R Server     </span></span><br><span class="line"><span class="keyword">library</span>(mrsdeploy)</span><br><span class="line"></span><br><span class="line"><span class="comment"># --- AAD login ----------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Use `remoteLogin` to authenticate with R Server using </span></span><br><span class="line"><span class="comment"># the local admin account. Use session = false so no </span></span><br><span class="line"><span class="comment"># remote R session started</span></span><br><span class="line"><span class="comment"># REMEMBER: Replace with your login details</span></span><br><span class="line">remoteLogin(<span class="string">"http://localhost:12800"</span>, </span><br><span class="line">            username = “admin”, </span><br><span class="line">            password = “&#123;&#123;YOUR_PASSWORD&#125;&#125;”,</span><br><span class="line">            session = <span class="literal">FALSE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Information can come from a file</span></span><br><span class="line">model &lt;- <span class="string">"model &lt;- glm(formula = am ~ hp + wt, data = mtcars, family = binomial)"</span></span><br><span class="line">code &lt;- <span class="string">"newdata &lt;- data.frame(hp = hp, wt = wt)\n</span></span><br><span class="line"><span class="string">         answer &lt;- predict(model, newdata, type = 'response')"</span></span><br><span class="line"></span><br><span class="line">cat(model, file = <span class="string">"transmission.R"</span>, append = <span class="literal">FALSE</span>)</span><br><span class="line">cat(code, file = <span class="string">"transmission-code.R"</span>, append = <span class="literal">FALSE</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Generate a unique serviceName for demos </span></span><br><span class="line"><span class="comment"># and assign to variable serviceName</span></span><br><span class="line">serviceName &lt;- paste0(<span class="string">"mtService"</span>, round(as.numeric(Sys.time()), <span class="number">0</span>))</span><br><span class="line"></span><br><span class="line">api &lt;- publishService(</span><br><span class="line">   serviceName,</span><br><span class="line">   code = <span class="string">"transmission-code.R"</span>,</span><br><span class="line">   model = <span class="string">"transmission.R"</span>,</span><br><span class="line">   inputs = list(hp = <span class="string">"numeric"</span>, wt = <span class="string">"numeric"</span>),</span><br><span class="line">   outputs = list(answer = <span class="string">"numeric"</span>),</span><br><span class="line">   v = <span class="string">"v1.0.3"</span>,</span><br><span class="line">   alias = <span class="string">"manualTransmission"</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">api</span><br><span class="line"></span><br><span class="line">result &lt;- api$manualTransmission(<span class="number">120</span>, <span class="number">2.8</span>)</span><br><span class="line">result</span><br><span class="line">print(result$output(<span class="string">"answer"</span>)) <span class="comment"># 0.6418125</span></span><br><span class="line"></span><br><span class="line">swagger &lt;- api$swagger()</span><br><span class="line">cat(swagger)</span><br><span class="line"></span><br><span class="line">swagger &lt;- api$swagger(json = <span class="literal">FALSE</span>)</span><br><span class="line">swagger</span><br><span class="line"></span><br><span class="line">services &lt;- listServices(serviceName)</span><br><span class="line">services</span><br><span class="line"></span><br><span class="line">serviceName &lt;- services[[<span class="number">1</span>]]</span><br><span class="line">serviceName</span><br><span class="line"></span><br><span class="line">api &lt;- getService(serviceName$name, serviceName$version)</span><br><span class="line">api</span><br><span class="line">result &lt;- api$manualTransmission(<span class="number">120</span>, <span class="number">2.8</span>)</span><br><span class="line">print(result$output(<span class="string">"answer"</span>)) <span class="comment"># 0.6418125</span></span><br><span class="line"></span><br><span class="line">cap &lt;- api$capabilities()</span><br><span class="line">cap</span><br><span class="line">cap$swagger</span><br><span class="line"></span><br><span class="line">status &lt;- deleteService(cap$name, cap$version)</span><br><span class="line">status</span><br><span class="line"></span><br><span class="line">remoteLogout()</span><br></pre></td></tr></table></figure><p>服务支持的参数的类型和返回值类型均为以下几种：</p><ul><li>numeric</li><li>integer</li><li>logical</li><li>character</li><li>vector</li><li>matrix</li><li>data.frame</li></ul><p>如果 <code>code</code> 是函数，只有一个值可以返回。</p><h2 id="代码和模型"><a href="#代码和模型" class="headerlink" title="代码和模型"></a>代码和模型</h2><h3 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h3><p>官方文档没有明确指出 Code 和 Model 的区别。但是从代码和性能分析的角度，可以发现 Code 和 Model 有以下区别：</p><ol><li>Model 部分的代码是发布服务的时候执行的， Code 部分则是在接收网络请求的时候执行的。因为 Model 部分只包含一个模型，不可能在每次网络请求中都执行，否则求解模型的时间会很长。在网络请求中， Model 部分会被加载到 Code 部分。</li><li>Model 部分不接收网络请求的参数（即发布服务时指定的 <code>inputs</code> ），也不提供返回参数（即发布服务时指定的 <code>outputs</code> ）。接收参数和返回参数的提供是在 Code 部分中进行的。</li><li>Model 部分一般是 R 对象， Code 部分一般是可执行体。</li></ol><p>由于有这样的区别，因此使用动态模型只能在 Code 中进行，而且最好将接口设计为异步接口。</p><h3 id="类型"><a href="#类型" class="headerlink" title="类型"></a>类型</h3><table><thead><tr><th></th><th>来源</th></tr></thead><tbody><tr><td>Code</td><td>指向 R 脚本的文件路径</td></tr><tr><td></td><td>字符串形式的 R 代码片段</td></tr><tr><td></td><td>R 函数</td></tr><tr><td>Model</td><td>指向 .RData 文件的路径</td></tr><tr><td></td><td>指向 R 脚本的文件路径，用于加载环境</td></tr><tr><td></td><td>模型对象，如 <code>model = am.glm</code></td></tr></tbody></table><h2 id="与-Web-服务集成"><a href="#与-Web-服务集成" class="headerlink" title="与 Web 服务集成"></a>与 Web 服务集成</h2><p>发布的 R 服务可以与 Web 服务集成。利用服务提供的 swagger.json 文件，可以使用 Swagger 自动生成 API 接口代码以及文档。主要流程为：</p><ol><li>获取 Swagger 工具和文件</li><li>使用 Swagger 生成 API 库</li><li>添加认证逻辑</li><li>通过库与 API 交互或使用服务</li></ol><p>以 mtService 与 ASP.NET 为例，首先创建 ASP.NET Web API 工程。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/编程/microsoft-machine-learning-server/1556151659023.png"> <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/编程/microsoft-machine-learning-server/1556152239472.png"><blockquote><p><strong><em>ASP.NET MVC 框架</em></strong></p><p>MVC 是三个 ASP.NET 开发模型之一。</p><p>MVC 是用于构建 web 应用程序的一种框架，使用 MVC (Model View Controller) 设计：</p><ul><li>Model（模型）表示应用程序核心（比如数据库记录列表）。是应用程序中用于处理应用程序数据逻辑的部分。通常模型对象在数据库中存取数据。</li><li>View（视图）对数据（数据库记录）进行显示。是应用程序中处理数据显示的部分。通常从模型数据中创建视图。</li><li>Controller（控制器）处理输入（写入数据库记录）。是应用程序中处理用户交互的部分。通常控制器从视图读取数据、控制用户输入，并向模型发送数据数据。</li></ul><p>MVC 的这种拆分有助于我们管理复杂的应用程序，因为您能够在同一时间关注一个方面。例如，您可以在不依赖业务逻辑的情况下对视图进行设计。同时对应用程序的设计也更加容易。MVC 的这种拆分同时也简化了分组开发。不同的开发人员可同时开发视图、控制器逻辑和业务逻辑。</p></blockquote><p>然后使用 AutoRest 或 Swagger Codegen 生成 C# 代码：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AutoRest.exe -CodeGenerator CSharp -Modeler Swagger -Input swagger.json -Namespace Transmission</span><br></pre></td></tr></table></figure><p>会在 swagger.json 所在文件夹下创建一个 Generate 文件夹，里面保存了生成的代码，文件结构如下：</p><ul><li>Models<ul><li>AccessTokenResponse.cs</li><li>BatchWebServiceResult.cs</li><li>Error.cs</li><li>ErrorException.cs</li><li>InputParameters.cs</li><li>LoginRequest.cs</li><li>OutputParameters.cs</li><li>RenewTokenRequest.cs</li><li>RenewTokenRequest.cs</li><li>StartBatchExecutionResponse.cs</li><li>WebServiceResult.cs</li></ul></li><li>IMtService1556106844.cs</li><li>MtService1556106844.cs</li><li>MtService1556106844Extensions.cs</li></ul><p>每个文件都包含一个类，这些类都声明在 <code>Transmission</code> 命名空间中，结合 C# 命名空间取值的特点，建议将这些文件放在 ASP.NET 工程根目录的 Transmission 目录下。</p><blockquote><p>另外一种方式，是将命名空间声明为 RService.Transmission ，可以将 R 服务都放置在工程根目录的 RService 目录下（如将这个服务放置在工程根目录的 RService/Transmission 目录下），便于多个接口的管理。</p></blockquote><p>然后 Controllers 文件夹下，创建一个 Web API 控制器类，命名为 <code>MtServiceController</code> 。即可生成一个 Controller 的基本代码。</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASwAAAEsCAMAAABOo35HAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAC9UExURVlZWdPT07KysmRkZIWFhfT09JmZmWZmZm9vb39/fxkZGUxMTDMzM3p6epCQkKamppubm729venp6cjIyN7e3tbW1s/Pz8LCwnx8fLS0tFZWVoiIiI+Pj6GhoeTk5Glpabu7u93d3evr66CgoJSUlKqqqsnJyeDg4Hd3d8PDw+Xl5bi4uNHR0dvb26Ojo6urq+fn51hYWDg4OCgoKHBwcK2traenp0FBQe7u7vHx8U5OTre3t8zMzHV1df///7GrnpQAAAA/dFJOU///////////////////////////////////////////////////////////////////////////////////AI4mfBcAAAUGSURBVHja7NoJb6M4GMZxY0NCD64kve/pMZ2d3Z297+X7f6zFNmBAMUXa6URl/q9UJSWPUPzrizFWRUlNLgEBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYYIEFAVhggQUWWGBBABZYYIEFFlgQgAUWWGCBBRYEYIEFFlhggQUBWGCBBRZYYEEAFlhggQUWWBCABRZYYIEFFgRggQUWWGCBBQFYYIEFFlhgQQAWWGCBBRZYEIAFFlhggQUWBGCBBRZYn6cCIcRXgvX/h9qcIVBqDdbEM8RCxGCB9QqXYRwHYDHBgwXWl8eKZKiESHI3Ba1kWs3fKixcaJUl1YyeBm7Ocq+yLItUiVBGnXxenSHJolIKEcwHq6ikbOX1YGVzQCTN8LPmSLreghUl9sN4Uw7yajMrLC0TZ1ImzqY6FEop0+pIaEN5HaoOxVuwEqFyc4I46uSlzOLqgxlh6UaR9l3VYWl9Fdoxb1Q90KJtu41pwwFW/WHhTtW8i7TafLCqRsk6bsGw63L9qurXRmuIlbT9lDQnlXU+nBFW1Q2qnZbDprWa2tjR90LZFqx1/+Td/HpGWLlrLDvIwTcx6dQ1Vrntbig68cDms3JwbA5Y1azs1ger6sNV/bbIw1jU81MvNAGrl58RVn8ozW+btF08iGFoAlYvP3csfVur1gJBEIA1uBmue5dhZDOyO2epbmgCVi8/I6x0MMHH9pjsTfBhNzQBq5uPZoQlB0uH3DZG4EZqQ26fL3sZq5uf09Ih6qw3i/pm6BZO0qZX7rrUS68Xsbr5ZE4rePMk08pk9aUZugfqppvs6AM1Acvlo/StP+6EbW06z8hJqxbYp2BZPQUnFsLsKuhQdaHqn5ewbF7KXIn0jWO5MqOQ7RaNLPtbNMmmhimj0GUmYLl8Gs0Lq4wyPbTu1l2QKqHSouzs3OlDIslW5SQsnY/NXmFplyNvEuuLV/Tau9BzwiraDUSwXmysztYWWNtL1psXeumgIrDGaqXvBfUuvtqUYI3V2t1wk1e2msFluJJm6zDJXv/fIfjPP7DAAgsssCiwwAILLLDAosACCyywwAKLAgsssMACC6zt9fDz/v75tyOB+98PD2+ORgKffjw4OP1uJPDxl+Xy8v1I4MPF3t7VNyOB4/vF4uzdzrG+39f1kz/w66Guv/yBvw90KX/gZKkr8Qf+2dOV+gNHC12/7RxrabD2/a31bLAO/a11YbAO/K21MFhLf2s9Gqw9f2vdGqzFu11jnVusE2/gxmI9eQOnFuvYG7i0WH7uK4t15w2cWazrXWP9a7H8f/bQYvm/6IPF+sF/pVssf19Ii/WH/0K2WH/uGuvEWC39gSdj9Twy+Rqri5EZx1gt/IE7Y/XoD1wbq9vd3w1PlufnD2OBp+ebm/uxwPHF6emnscDR4vLy41jg7vHq6sNY4Pr27OyYdRaLUrDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssMCiwAILLLDAAosCCyywwAILLAossMACCyywKLDAAgsssL6u+k+AAQCR9eHtLKvLfwAAAABJRU5ErkJggg==" data-original="/编程/microsoft-machine-learning-server/1556152306950.png"><p>基本代码如下：</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.Linq;</span><br><span class="line"><span class="keyword">using</span> System.Net;</span><br><span class="line"><span class="keyword">using</span> System.Net.Http;</span><br><span class="line"><span class="keyword">using</span> System.Web.Http;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">TestRService.Controllers</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TempController</span> : <span class="title">ApiController</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// GET api/&lt;controller&gt;</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> IEnumerable&lt;<span class="keyword">string</span>&gt; <span class="title">Get</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="keyword">string</span>[] &#123; <span class="string">"value1"</span>, <span class="string">"value2"</span> &#125;;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// GET api/&lt;controller&gt;/5</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">Get</span>(<span class="params"><span class="keyword">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"value"</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// POST api/&lt;controller&gt;</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Post</span>(<span class="params">[FromBody]<span class="keyword">string</span> <span class="keyword">value</span></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// PUT api/&lt;controller&gt;/5</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Put</span>(<span class="params"><span class="keyword">int</span> id, [FromBody]<span class="keyword">string</span> <span class="keyword">value</span></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// DELETE api/&lt;controller&gt;/5</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Delete</span>(<span class="params"><span class="keyword">int</span> id</span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>该基本代码提供了 GET 、 POST 、 PUT 、 DELETE 四种 HTTP 请求类型的支持。现在只需要对这些进行修改。即可。</p><p>对带参数的 GET 方法进行修改的方法</p><ol><li><p>将参数修改为两个： <code>hp</code> 和 <code>wt</code> 。直接修改 <code>public string Get(int id)</code> 的声明：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="deletion">- public string Get(int id)</span></span><br><span class="line"><span class="addition">+ public double? Get(double hp, double wt)</span></span><br></pre></td></tr></table></figure><p>即对 GET 方法添加了两个参数，都是 <code>double</code> 类型。</p></li><li><p>创建 R 服务对象，指明服务基地址。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">double</span>? Get(<span class="keyword">double</span> hp, <span class="keyword">double</span> wt)</span><br><span class="line">&#123;</span><br><span class="line">    MtService1556106844 client = <span class="keyword">new</span> MtService1556106844(<span class="keyword">new</span> Uri(<span class="string">"http://192.168.41.49:12800"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在有 SSL 证书时可以使用 HTTPS 协议。</p></li><li><p>添加服务的认证：在 Get 方法中使用 Transmission 库自带的 <code>LoginRequest</code> 类进行认证。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">double</span>? Get(<span class="keyword">double</span> hp, <span class="keyword">double</span> wt)</span><br><span class="line">&#123;</span><br><span class="line">    MtService1556106844 client = <span class="keyword">new</span> MtService1556106844(<span class="keyword">new</span> Uri(<span class="string">"http://192.168.41.49:12800"</span>));</span><br><span class="line">    <span class="comment">// --- AUTHENTICATE WITH ACTIVE DIRECTORY -----------------------------------------</span></span><br><span class="line">    <span class="comment">// Note - Update these with your appropriate values</span></span><br><span class="line">    <span class="comment">// Once authenticated, user won't provide credentials again until token is invalid.</span></span><br><span class="line">    <span class="comment">// You can now begin to interact with the operationalization APIs</span></span><br><span class="line">    <span class="comment">// --------------------------------------------------------------------------------</span></span><br><span class="line">    <span class="keyword">var</span> loginRequest = <span class="keyword">new</span> LoginRequest(<span class="string">"admin"</span>, <span class="string">"GWmodel-Lab2018"</span>);</span><br><span class="line">    <span class="keyword">var</span> loginResponse = client.Login(loginRequest);</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// SET AUTHORIZATION HEADER WITH BEARER ACCESS TOKEN FOR FUTURE CALLS</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">var</span> headers = client.HttpClient.DefaultRequestHeaders;</span><br><span class="line">    <span class="keyword">var</span> accessToken = loginResponse.AccessToken;</span><br><span class="line">    headers.Remove(<span class="string">"Authorization"</span>);</span><br><span class="line">    headers.Add(<span class="string">"Authorization"</span>, <span class="string">$"Bearer <span class="subst">&#123;accessToken&#125;</span>"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这里的用户名 <code>admin</code> 和密码 <code>GWmodel-Lab2018</code> 是 Machine Learning Server 在启动的时候，设置的用户名和密码。</p></li><li><p>调用 R 服务并返回结果：在 Get 方法中使用 Transmission 库调用 R 服务。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">double</span>? Get(<span class="keyword">double</span> hp, <span class="keyword">double</span> wt)</span><br><span class="line">&#123;</span><br><span class="line">    MtService1556106844 client = <span class="keyword">new</span> MtService1556106844(<span class="keyword">new</span> Uri(<span class="string">"http://192.168.41.49:12800"</span>));</span><br><span class="line">    <span class="comment">// --- AUTHENTICATE WITH ACTIVE DIRECTORY -----------------------------------------</span></span><br><span class="line">    <span class="comment">// Note - Update these with your appropriate values</span></span><br><span class="line">    <span class="comment">// Once authenticated, user won't provide credentials again until token is invalid.</span></span><br><span class="line">    <span class="comment">// You can now begin to interact with the operationalization APIs</span></span><br><span class="line">    <span class="comment">// --------------------------------------------------------------------------------</span></span><br><span class="line">    <span class="keyword">var</span> loginRequest = <span class="keyword">new</span> LoginRequest(<span class="string">"admin"</span>, <span class="string">"GWmodel-Lab2018"</span>);</span><br><span class="line">    <span class="keyword">var</span> loginResponse = client.Login(loginRequest);</span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="comment">// SET AUTHORIZATION HEADER WITH BEARER ACCESS TOKEN FOR FUTURE CALLS</span></span><br><span class="line">    <span class="comment">//</span></span><br><span class="line">    <span class="keyword">var</span> headers = client.HttpClient.DefaultRequestHeaders;</span><br><span class="line">    <span class="keyword">var</span> accessToken = loginResponse.AccessToken;</span><br><span class="line">    headers.Remove(<span class="string">"Authorization"</span>);</span><br><span class="line">    headers.Add(<span class="string">"Authorization"</span>, <span class="string">$"Bearer <span class="subst">&#123;accessToken&#125;</span>"</span>);</span><br><span class="line">    </span><br><span class="line">    InputParameters inputs = <span class="keyword">new</span> InputParameters() &#123; Hp = hp, Wt = wt &#125;;</span><br><span class="line">	<span class="keyword">var</span> serviceResult = client.ManualTransmission(inputs);</span><br><span class="line">	<span class="keyword">return</span> serviceResult.OutputParameters.Answer;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>POST 方法、 PUT 方法的编写本质上和 GET 方法的编写没有什么区别。不同的地方在于， POST 方法中的参数通过请求体进行，而不是请求地址。参数类型可以直接声明为 <code>InputParameters</code> 类型，因为这个类型支持 JSON 反序列化。</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> <span class="title">Transmission.Models</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">using</span> Newtonsoft.Json;</span><br><span class="line">    <span class="keyword">using</span> System.Linq;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">partial</span> <span class="keyword">class</span> <span class="title">InputParameters</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InputParameters</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>        &#123;</span><br><span class="line">            CustomInit();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">InputParameters</span>(<span class="params"><span class="keyword">double</span>? hp = <span class="keyword">default</span>(<span class="keyword">double</span>?</span>), <span class="keyword">double</span>? wt</span> = <span class="keyword">default</span>(<span class="keyword">double</span>?))</span><br><span class="line">        &#123;</span><br><span class="line">            Hp = hp;</span><br><span class="line">            Wt = wt;</span><br><span class="line">            CustomInit();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">partial</span> <span class="keyword">void</span> <span class="title">CustomInit</span>(<span class="params"></span>)</span>;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">JsonProperty(PropertyName = <span class="meta-string">"hp"</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">double</span>? Hp &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">        [<span class="meta">JsonProperty(PropertyName = <span class="meta-string">"wt"</span>)</span>]</span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">double</span>? Wt &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>当请求体是如下的 HTTP 请求时，程序可以自动获取到这些参数：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">http://localhost:64620/api/MtService</span> HTTP/1.1</span><br><span class="line"><span class="attribute">Content-Type</span>: application/json</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">    "hp": 120,</span><br><span class="line">    "wt": 2.8</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>另外，在 GET 等方法的返回值中，如果 R 服务的返回值类型是 vector 、 matrix 或 data.frame ，那么不能直接以 XML 返回，需要调用 <code>ToString()</code> 函数返回。但是可以直接以 JSON 返回。方法是：</p><figure class="highlight diff"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">public double? Get(double hp, double wt)</span><br><span class="line">&#123;</span><br><span class="line">    MtService1556106844 client = new MtService1556106844(new Uri("http://192.168.41.49:12800"));</span><br><span class="line">    // --- AUTHENTICATE WITH ACTIVE DIRECTORY -----------------------------------------</span><br><span class="line">    // Note - Update these with your appropriate values</span><br><span class="line">    // Once authenticated, user won't provide credentials again until token is invalid.</span><br><span class="line">    // You can now begin to interact with the operationalization APIs</span><br><span class="line">    // --------------------------------------------------------------------------------</span><br><span class="line">    var loginRequest = new LoginRequest("admin", "GWmodel-Lab2018");</span><br><span class="line">    var loginResponse = client.Login(loginRequest);</span><br><span class="line">    //</span><br><span class="line">    // SET AUTHORIZATION HEADER WITH BEARER ACCESS TOKEN FOR FUTURE CALLS</span><br><span class="line">    //</span><br><span class="line">    var headers = client.HttpClient.DefaultRequestHeaders;</span><br><span class="line">    var accessToken = loginResponse.AccessToken;</span><br><span class="line">    headers.Remove("Authorization");</span><br><span class="line">    headers.Add("Authorization", $"Bearer &#123;accessToken&#125;");</span><br><span class="line">    </span><br><span class="line">    InputParameters inputs = new InputParameters() &#123; Hp = hp, Wt = wt &#125;;</span><br><span class="line">	var serviceResult = client.ManualTransmission(inputs);</span><br><span class="line"><span class="deletion">-	return serviceResult.OutputParameters.Answer;</span></span><br><span class="line"><span class="addition">+	return Json(serviceResult.OutputParameters.Answer);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="连接池"><a href="#连接池" class="headerlink" title="连接池"></a>连接池</h2><p>当您提前创建会话和加载依赖项时，可以快速连接到Web服务。 会话在专用于特定Web服务的池中可用，其中每个会话包括R解释器的实例和Web服务所需的依赖关系的副本。 例如，如果您为使用Matplotlib，dplyr，cluster，RevoScaleR，MicrosoftML和mrsdeploy的Web服务提前创建了10个会话，则每个会话都将拥有自己的R解释器实例以及内存中加载的每个库的副本。</p><p>具有专用会话池的Web服务从不请求来自通用会话池共享资源的连接，即使在达到最大会话时也是如此。 通用会话池仅为那些没有专用资源的Web服务提供服务。</p><p><code>mrsdeploy</code> 提供以下三个函数来创建和管理会话：</p><ul><li>configureServicePool</li><li>getPoolStatus</li><li>deleteServicePool</li></ul><p>创建连接池：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># load mrsdeploy and print the function list</span></span><br><span class="line"><span class="keyword">library</span>(mrsdeploy)</span><br><span class="line">ls(<span class="string">"package:mrsdeploy"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Return a list of web services to get the service and version </span></span><br><span class="line"><span class="comment"># Both service name and version number are required</span></span><br><span class="line">listServices()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the session pool using a case-sensitive web service name</span></span><br><span class="line"><span class="comment"># A status code of 200 is returned upon success</span></span><br><span class="line">configureServicePool(name = <span class="string">"myWebservice1234"</span>, version = <span class="string">"v1.0.0"</span>, initialPoolSize = <span class="number">5</span>, maxPoolSize = <span class="number">10</span> )</span><br><span class="line"></span><br><span class="line"><span class="comment"># Return status </span></span><br><span class="line"><span class="comment"># Pending indicates session creation is in progress. Success indicates sessions are ready.</span></span><br><span class="line">getPoolStatus(name = <span class="string">"myWebService1234"</span>, version = <span class="string">"v1.0.0"</span>)</span><br></pre></td></tr></table></figure><p>删除连接池：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Return a list of web services to get the service and version information</span></span><br><span class="line">listServices()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Deletes the dedicated session pool and releases resources</span></span><br><span class="line">deleteServicePool(name = <span class="string">"myWebService1234"</span>, version = <span class="string">"v1.0.0"</span>)</span><br></pre></td></tr></table></figure><p>获取连接池信息：</p><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deletes the dedicated session pool and releases resources</span></span><br><span class="line">deleteServicePool(name = <span class="string">"myWebService1234"</span>, version = <span class="string">"v1.0.0"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Check the real-time status of dedicated pool</span></span><br><span class="line">getPoolStatus(name = <span class="string">"myWebService1234"</span>, version = <span class="string">"v1.0.0"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># make sure the return status is NotFound on all computeNodes</span></span><br><span class="line"><span class="comment"># if not, issue anthor deleteServicePool command again</span></span><br></pre></td></tr></table></figure><div class="post-announce">感谢您的阅读，本文由 <a href="http://hpdell.github.io">HPDell 的个人博客</a> 版权所有。如若转载，请注明出处：HPDell 的个人博客（<a href="http://hpdell.github.io/编程/microsoft-machine-learning-server/">http://hpdell.github.io/编程/microsoft-machine-learning-server/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/编程/hexo-metaweblog-guide/" title="通过 Metaweblog API 给 Hexo 接入客户端"><i class="iconfont icon-prev"></i>通过 Metaweblog API 给 Hexo 接入客户端</a></div><div class="post__prev post__prev--right"><a href="/编程/html5-rtsp/" title="HTML5 播放 RTSP 视频">HTML5 播放 RTSP 视频<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">HPDell 的博客</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/随笔/">随笔</a><span class="block-list-count">5</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/编程/">编程</a><span class="block-list-count">18</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/其他/">其他</a><span class="block-list-count">5</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/编程/windows-r-cuda/" title="让 Windows 的 R 用上 CUDA"><div class="item__cover"><img src="/assets/cover/windows-r-cuda.png" alt="让 Windows 的 R 用上 CUDA"></div><div class="item__info"><h3 class="item__title">让 Windows 的 R 用上 CUDA</h3><span class="item__text">2019-08-12</span></div></a></li><li class="latest-post-item"><a href="/编程/html5-rtsp/" title="HTML5 播放 RTSP 视频"><div class="item__cover"><img src="/assets/cover/html5-rtsp.jpg" alt="HTML5 播放 RTSP 视频"></div><div class="item__info"><h3 class="item__title">HTML5 播放 RTSP 视频</h3><span class="item__text">2019-03-04</span></div></a></li><li class="latest-post-item"><a href="/编程/microsoft-machine-learning-server/" title="Microsoft Machine Learning Server 使用调研"><div class="item__cover"><img src="/assets/img/header_cover.jpg" alt="Microsoft Machine Learning Server 使用调研"></div><div class="item__info"><h3 class="item__title">Microsoft Machine Learning Server 使用调研</h3><span class="item__text">2019-03-04</span></div></a></li><li class="latest-post-item"><a href="/编程/hexo-metaweblog-guide/" title="通过 Metaweblog API 给 Hexo 接入客户端"><div class="item__cover"><img src="/assets/img/header_cover.jpg" alt="通过 Metaweblog API 给 Hexo 接入客户端"></div><div class="item__info"><h3 class="item__title">通过 Metaweblog API 给 Hexo 接入客户端</h3><span class="item__text">2019-02-26</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/Apache-POI/">Apache POI</a></li><li class="tag-item"><a class="tag-link" href="/tags/C/">C#</a></li><li class="tag-item"><a class="tag-link" href="/tags/CUDA/">CUDA</a></li><li class="tag-item"><a class="tag-link" href="/tags/LaTeX/">LaTeX</a></li><li class="tag-item"><a class="tag-link" href="/tags/Linux/">Linux</a></li><li class="tag-item"><a class="tag-link" href="/tags/Node-js/">Node.js</a></li><li class="tag-item"><a class="tag-link" href="/tags/Python/">Python</a></li><li class="tag-item"><a class="tag-link" href="/tags/R/">R</a></li><li class="tag-item"><a class="tag-link" href="/tags/TypeScript/">TypeScript</a></li><li class="tag-item"><a class="tag-link" href="/tags/Vue/">Vue</a></li><li class="tag-item"><a class="tag-link" href="/tags/WPF/">WPF</a></li><li class="tag-item"><a class="tag-link" href="/tags/XAML/">XAML</a></li><li class="tag-item"><a class="tag-link" href="/tags/jQuery-Mobile/">jQuery Mobile</a></li><li class="tag-item"><a class="tag-link" href="/tags/travis/">travis</a></li><li class="tag-item"><a class="tag-link" href="/tags/博客相关/">博客相关</a></li><li class="tag-item"><a class="tag-link" href="/tags/哈利波特/">哈利波特</a></li><li class="tag-item"><a class="tag-link" href="/tags/影评/">影评</a></li><li class="tag-item"><a class="tag-link" href="/tags/测试/">测试</a></li><li class="tag-item"><a class="tag-link" href="/tags/爬虫/">爬虫</a></li><li class="tag-item"><a class="tag-link" href="/tags/电影/">电影</a></li><li class="tag-item"><a class="tag-link" href="/tags/网页开发/">网页开发</a></li><li class="tag-item"><a class="tag-link" href="/tags/课程/">课程</a></li><li class="tag-item"><a class="tag-link" href="/tags/路网速度/">路网速度</a></li><li class="tag-item"><a class="tag-link" href="/tags/随笔/">随笔</a></li></ul></div><div class="sidebar__block__sticky"><h3 class="block__title">目录</h3><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Machine-Learning-Server-主要功能"><span class="toc-text">Machine Learning Server 主要功能</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#RevoScaleR-库"><span class="toc-text">RevoScaleR 库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#数据处理"><span class="toc-text">数据处理</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#数据可视化"><span class="toc-text">数据可视化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#在-Machine-Learning-Server-中运行-R-代码"><span class="toc-text">在 Machine Learning Server 中运行 R 代码</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#计算上下文"><span class="toc-text">计算上下文</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#远程执行-R-代码"><span class="toc-text">远程执行 R 代码</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#创建远程会话"><span class="toc-text">创建远程会话</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#在会话间切换或退出"><span class="toc-text">在会话间切换或退出</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#远程执行-R-脚本"><span class="toc-text">远程执行 R 脚本</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#远程使用R对象和文件"><span class="toc-text">远程使用R对象和文件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#绘图的注意事项"><span class="toc-text">绘图的注意事项</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#将模型作为-Web-服务发布"><span class="toc-text">将模型作为 Web 服务发布</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#主要流程"><span class="toc-text">主要流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#发布服务"><span class="toc-text">发布服务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#代码和模型"><span class="toc-text">代码和模型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#区别"><span class="toc-text">区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类型"><span class="toc-text">类型</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#与-Web-服务集成"><span class="toc-text">与 Web 服务集成</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#连接池"><span class="toc-text">连接池</span></a></li></ol></li></ol></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">HPDell的博客，基于Hexo。分享生活，分享技术，分享观点，为自己留下感动。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Wuhan University, Luoyu Road, Wuhan, Hubei, China.</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>huyg0180110559@outlook.com</span></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://zone.huyg.site/" title="我的动态博客" target="_blank">我的动态博客</a></li><li class="list-item"><a href="https://hkvision.cn/" title="HaoKunT的博客" target="_blank">HaoKunT的博客</a></li><li class="list-item"><a href="https://home.cs-tao.cc/" title="这是一个不能停留太久的世界" target="_blank">CS-Tao</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/HPDell" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:huyg0180110559@outlook.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li><li class="social-network__item"><a href="https://www.zhihu.com/people/hu-yi-gong-63/activities" target="_blank" title="知乎"><i class="iconfont icon-zhihu"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["R"],gitalk=new Gitalk({clientID:"47d3a0c03f3c07172ecc",clientSecret:"8e0da02c5e757c77b93627a7e380e43a248d001c",repo:"HPDell.github.io",owner:"HPDell",admin:["HPDell"],labels:tags,id:new Date(1551711685e3).getTime()>new Date("2018-02-15").getTime()?md5(encodeURI(decodeURI(location.href))):location.href});gitalk.render("comment-container")</script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>!function(n){var o=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(t,e){var n=new Image,o=t.getAttribute("data-original");n.onload=function(){t.src=o,e&&e()},n.src=o}function c(){for(var t=0;t<o.length;t++)0<=(e=o[t].getBoundingClientRect()).top&&0<=e.left&&e.top<=(n.innerHeight||document.documentElement.clientHeight)&&i(o[t],function(){o.splice(t,t)});var e;console.log("trigger")}c(),n.addEventListener("scroll",function(){var t,e;t=c,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script></body></html>