<!DOCTYPE html><html lang="zh-cn"><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><title>通过 Metaweblog API 给 Hexo 接入客户端 | 我们在小孩和大人的转角盖一座城堡</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="hpdell"><meta name="designer" content="minfive"><meta name="keywords" content="undefined"><meta name="description" content="HPDell 的博客"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="http://hpdell.github.io/编程/hexo-metaweblog-guide/index.html"><link rel="icon" type="image/png" href="/assets/img/avatar.jpg" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="HPDell 的个人博客"><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart=""><div id="page-loading" class="page page-loading" style="background-image:url(undefined)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="HPDell 的个人博客" alt="HPDell 的个人博客"><img src="/assets/img/avatar.jpg" alt="HPDell 的个人博客"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="/assets/img/header_cover.jpg" alt="通过 Metaweblog API 给 Hexo 接入客户端"></div><header class="post__info"><h1 class="post__title">通过 Metaweblog API 给 Hexo 接入客户端</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/">HPDell</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2019-02-26</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/TypeScript/">TypeScript</a></li><li class="mark__item"><a href="/tags/Node-js/">Node.js</a></li><li class="mark__item"><a href="/tags/博客相关/">博客相关</a></li></ul></div></div></header><div class="post__content"><h1 id="Hexo-搭建静态博客的问题"><a href="#Hexo-搭建静态博客的问题" class="headerlink" title="Hexo 搭建静态博客的问题"></a>Hexo 搭建静态博客的问题</h1><p>Hexo + GitHub Pages 搭建博客的方式已经非常流行了。但是 Hexo 的写作几乎必须在电脑上进行。在 Travis 等 CI 工具的支持下，可以通过在 GitHub 页面上新建文件，编写内容，然后通过 Travis CI 持续集成，发布到 GitHub Pages 。但这个流程相当麻烦，而且在 iOS 上 GitHub 网页的那个编辑器不能直接输入中文。</p><p>解决方法有两种。</p><ul><li>搭建动态博客。给动态博客里面加入一个编辑器，这样在手机或平板上就可以进行编辑，没有 Hexo 环境也没关系。</li><li>使用 Metaweblog API 。一些写作软件，如 <a href="https://zh.mweb.im/" target="_blank" rel="noopener">MWeb</a> 等都支持这个 API 。但是需要我们实现一套这样的 API，才能使用。</li></ul><p>本文主要介绍如何使用 Express 实现这套接口。</p><h1 id="依赖库"><a href="#依赖库" class="headerlink" title="依赖库"></a>依赖库</h1><p>以下是主要用到的依赖库：</p><ul><li>express</li><li>fs-extra</li><li>simple-git</li><li>hexo</li><li>md5</li></ul><h1 id="主要接口"><a href="#主要接口" class="headerlink" title="主要接口"></a>主要接口</h1><p>MWeb 调用了两种接口，一种是 Metaweblog API ，一种是 Blogger API 。下面分别介绍参数</p><h2 id="Metaweblog-API"><a href="#Metaweblog-API" class="headerlink" title="Metaweblog API"></a>Metaweblog API</h2><p>下面列出的是接口的参数：</p><table><thead><tr><th>接口</th><th>说明</th><th>参数</th><th>类型</th><th>参数说明</th></tr></thead><tbody><tr><td><code>newPost</code></td><td>新增一篇博客</td><td><code>blogid</code></td><td><code>String</code></td><td>博客 ID ，适用于一个网站很多博客的那种（如 CSDN ）</td></tr><tr><td></td><td></td><td><code>username</code></td><td><code>String</code></td><td>用户名</td></tr><tr><td></td><td></td><td><code>password</code></td><td><code>String</code></td><td>密码</td></tr><tr><td></td><td></td><td><code>post</code></td><td><code>PostContent</code></td><td>文章内容，具体类型详见下面的代码</td></tr><tr><td><code>getPost</code></td><td>获取一篇博客</td><td><code>postid</code></td><td><code>String</code></td><td>文章 ID ，由 <code>newPost</code> 接口返回</td></tr><tr><td></td><td></td><td><code>username</code></td><td><code>String</code></td><td></td></tr><tr><td></td><td></td><td><code>password</code></td><td><code>String</code></td><td></td></tr><tr><td><code>getCategories</code></td><td>获取博客的分类</td><td><code>blogid</code></td><td><code>String</code></td><td></td></tr><tr><td></td><td></td><td><code>username</code></td><td><code>String</code></td><td></td></tr><tr><td></td><td></td><td><code>password</code></td><td><code>String</code></td><td></td></tr><tr><td><code>newMediaObject</code></td><td>添加多媒体文件</td><td><code>blogid</code></td><td><code>String</code></td><td></td></tr><tr><td></td><td></td><td><code>username</code></td><td><code>String</code></td><td></td></tr><tr><td></td><td></td><td><code>password</code></td><td><code>String</code></td><td></td></tr><tr><td></td><td></td><td><code>mediaObject</code></td><td><code>MediaObject</code></td><td>多媒体文件，具体类型详见下面的代码</td></tr></tbody></table><p>上面两个结构体的定义（ Typescript 描述法）：</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> PostContent &#123;</span><br><span class="line">    categories: <span class="built_in">string</span>[];	<span class="comment">// 分类</span></span><br><span class="line">    dateCreated: <span class="built_in">Date</span>;		<span class="comment">// 创建日期</span></span><br><span class="line">    description: <span class="built_in">string</span>;	<span class="comment">// 文章内容</span></span><br><span class="line">    title: <span class="built_in">string</span>;			<span class="comment">// 文章标题</span></span><br><span class="line">    mt_keywords: <span class="built_in">string</span>;	<span class="comment">// 标签</span></span><br><span class="line">    wp_slug: <span class="built_in">string</span>;		<span class="comment">// 自定义 Web 链接</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> MediaObject &#123;</span><br><span class="line">    overwrite: <span class="built_in">boolean</span>;</span><br><span class="line">    bits: Buffer;			<span class="comment">// 多媒体二进制数据</span></span><br><span class="line">    name: <span class="built_in">string</span>;			<span class="comment">// 文件名</span></span><br><span class="line">    <span class="keyword">type</span>: <span class="built_in">string</span>;			<span class="comment">// MIME 类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> Category &#123;</span><br><span class="line">    categoryid: <span class="built_in">string</span>;		<span class="comment">// 分类ID</span></span><br><span class="line">    description: <span class="built_in">string</span>;	<span class="comment">// 分类描述</span></span><br><span class="line">    title: <span class="built_in">string</span>;			<span class="comment">// 分类名称</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> NewMediaObjectReturnType &#123;</span><br><span class="line">    url: <span class="built_in">string</span>;			<span class="comment">// 媒体文件访问地址</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>下面是这几个接口的返回类型：</p><table><thead><tr><th>接口</th><th>返回类型</th><th>说明</th></tr></thead><tbody><tr><td><code>newPost</code></td><td><code>String</code></td><td>返回的是文章的 <code>PostID</code></td></tr><tr><td><code>getPost</code></td><td><code>PostContent</code></td><td>返回文章的结构体</td></tr><tr><td><code>getCategories</code></td><td><code>Category[]</code></td><td>返回的是分类的结构体数组</td></tr><tr><td><code>newMediaObject</code></td><td><code>NewMediaObjectReturnType</code></td><td>返回的是表示媒体文件访问信息的结构体</td></tr></tbody></table><h2 id="Blogger-API"><a href="#Blogger-API" class="headerlink" title="Blogger API"></a>Blogger API</h2><p>这里只用到了一个接口</p><table><thead><tr><th>名称</th><th>说明</th><th>参数</th><th>参数类型</th><th>参数说明</th><th>返回类型</th></tr></thead><tbody><tr><td><code>getUserBlogs</code></td><td>获取博客信息</td><td><code>key</code></td><td><code>String</code></td><td>(不用)</td><td><code>GetUserBlogsReturnType</code></td></tr><tr><td></td><td></td><td><code>username</code></td><td><code>String</code></td><td>用户名</td><td></td></tr><tr><td></td><td></td><td><code>password</code></td><td><code>String</code></td><td>密码</td></tr></tbody></table><p>接口返回信息</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> GetUserBlogsReturnType &#123;</span><br><span class="line">    blogid: <span class="built_in">string</span>		<span class="comment">// 博客 ID</span></span><br><span class="line">    blogName: <span class="built_in">string</span>	<span class="comment">// 博客名称</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="基于-express-和-xrpc-库的实现方式"><a href="#基于-express-和-xrpc-库的实现方式" class="headerlink" title="基于 express 和 xrpc 库的实现方式"></a>基于 express 和 xrpc 库的实现方式</h1><p>XML-RPC 协议的解析可以利用 xrpc 库进行实现。<code>app.ts</code> 的写法为</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> express <span class="keyword">from</span> <span class="string">'express'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> path <span class="keyword">from</span> <span class="string">'path'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> favicon <span class="keyword">from</span> <span class="string">'serve-favicon'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> logger <span class="keyword">from</span> <span class="string">'morgan'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> cookieParser <span class="keyword">from</span> <span class="string">'cookie-parser'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> bodyParser <span class="keyword">from</span> <span class="string">'body-parser'</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> xrpc <span class="keyword">from</span> <span class="string">"xrpc"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; newPost, getPost, editPost, getCategories, newMediaObject &#125; <span class="keyword">from</span> <span class="string">'./metaweblog'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; getUserBlogs &#125; <span class="keyword">from</span> <span class="string">'./blogger'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ExpressError <span class="keyword">extends</span> <span class="built_in">Error</span> &#123;</span><br><span class="line">  status: <span class="built_in">number</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.use(logger(<span class="string">'dev'</span>));</span><br><span class="line">app.use(bodyParser.json());</span><br><span class="line">app.use(bodyParser.urlencoded(&#123; extended: <span class="literal">false</span> &#125;));</span><br><span class="line">app.use(cookieParser());</span><br><span class="line">app.use(express.static(path.join(__dirname, <span class="string">'public'</span>)));</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 增加的 xrpc 部分</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">app.use(xrpc.xmlRpc);</span><br><span class="line">app.post(<span class="string">'/RPC'</span>, xrpc.route(&#123;</span><br><span class="line">  metaWeblog: &#123;</span><br><span class="line">    newPost: newPost,</span><br><span class="line">    getPost: getPost,</span><br><span class="line">    getCategories: getCategories,</span><br><span class="line">    newMediaObject: newMediaObject</span><br><span class="line">  &#125;,</span><br><span class="line">  blogger: &#123;</span><br><span class="line">    getUsersBlogs: getUserBlogs,</span><br><span class="line">  &#125;</span><br><span class="line">&#125;));</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * RPC</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// catch 404 and forward to error handler</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> err = <span class="keyword">new</span> ExpressError(<span class="string">'Not Found'</span>);</span><br><span class="line">  err.status = <span class="number">404</span>;</span><br><span class="line">  next(err);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// error handler</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// set locals, only providing error in development</span></span><br><span class="line">  res.locals.message = err.message;</span><br><span class="line">  res.locals.error = req.app.get(<span class="string">'env'</span>) === <span class="string">'development'</span> ? err : &#123;&#125;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// render the error page</span></span><br><span class="line">  res.status(err.status || <span class="number">500</span>);</span><br><span class="line">  res.render(<span class="string">'error'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = app;</span><br></pre></td></tr></table></figure><p><code>metaweblog.ts</code> 的实现方式</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> md5 <span class="keyword">from</span> <span class="string">"md5"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> fs <span class="keyword">from</span> <span class="string">"fs-extra"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> simplegit <span class="keyword">from</span> <span class="string">"simple-git/promise"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> path <span class="keyword">from</span> <span class="string">"path"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> moment <span class="keyword">from</span> <span class="string">"moment"</span>;</span><br><span class="line"><span class="keyword">import</span> * <span class="keyword">as</span> Hexo <span class="keyword">from</span> <span class="string">"hexo"</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Stream &#125; <span class="keyword">from</span> <span class="string">"stream"</span>;</span><br><span class="line"><span class="keyword">const</span> config = <span class="built_in">require</span>(<span class="string">"./package.json"</span>);</span><br><span class="line"><span class="keyword">const</span> blog = config.meta.blog</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> ExpressError <span class="keyword">extends</span> <span class="built_in">Error</span> &#123;</span><br><span class="line">    status: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">msg, code</span>) &#123;</span><br><span class="line">        <span class="keyword">super</span>(msg);</span><br><span class="line">        <span class="keyword">this</span>.status = code;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> hexo = <span class="keyword">new</span> Hexo(blog, &#123;</span><br><span class="line">    silent: <span class="literal">true</span>,</span><br><span class="line">    safe: <span class="literal">true</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> PostContent &#123;</span><br><span class="line">    categories: <span class="built_in">string</span>[];</span><br><span class="line">    dateCreated: <span class="built_in">Date</span>;</span><br><span class="line">    description: <span class="built_in">string</span>;</span><br><span class="line">    title: <span class="built_in">string</span>;</span><br><span class="line">    mt_keywords: <span class="built_in">string</span>;</span><br><span class="line">    wp_slug: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> MediaObject &#123;</span><br><span class="line">    overwrite: <span class="built_in">boolean</span>;</span><br><span class="line">    bits: Buffer;</span><br><span class="line">    name: <span class="built_in">string</span>;</span><br><span class="line">    <span class="keyword">type</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">newPost</span>(<span class="params">blogid: <span class="built_in">string</span>, username: <span class="built_in">string</span>, password: <span class="built_in">string</span>, post: PostContent, publish: <span class="built_in">boolean</span>, callback: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (blogid) &#123;</span><br><span class="line">        <span class="keyword">if</span> (username.toLowerCase() === <span class="string">"hpdell"</span> &amp;&amp; md5(password) === <span class="string">"2b759a6996d878c41bb7d56ce530d031"</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> git = simplegit(blog);</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">await</span> git.checkIsRepo()) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="keyword">let</span> postInfo = (<span class="keyword">await</span> fs.readFile(path.resolve(path.join(blog, <span class="string">"scaffolds"</span>, <span class="string">"post.md"</span>)))).toString();</span><br><span class="line">                    postInfo = postInfo.replace(<span class="string">"&#123;&#123; title &#125;&#125;"</span>, post.title);</span><br><span class="line">                    postInfo = postInfo.replace(<span class="string">"&#123;&#123; date &#125;&#125;"</span>, moment(post.dateCreated).format(<span class="string">"YYYY-MM-DD HH:mm:ss"</span>));</span><br><span class="line">                    <span class="keyword">if</span> (post.categories &amp;&amp; post.categories.length) &#123;</span><br><span class="line">                        postInfo = postInfo.replace(<span class="string">"categories:"</span>, <span class="string">`categories: <span class="subst">$&#123;post.categories[0]&#125;</span>`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (post.mt_keywords) &#123;</span><br><span class="line">                        <span class="keyword">let</span> tags = post.mt_keywords.split(<span class="string">","</span>);</span><br><span class="line">                        <span class="keyword">let</span> tagInfo = tags.map(<span class="function"><span class="params">item</span> =&gt;</span> <span class="string">`    - <span class="subst">$&#123;item&#125;</span>`</span>).join(<span class="string">"\n"</span>);</span><br><span class="line">                        postInfo = postInfo.replace(<span class="string">"tags:"</span>, <span class="string">`tags:\n<span class="subst">$&#123;tagInfo&#125;</span>`</span>);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">let</span> content = postInfo + post.description;</span><br><span class="line">                    <span class="keyword">let</span> postPath = path.resolve(path.join(blog, <span class="string">"source"</span>, <span class="string">"_posts"</span>, <span class="string">`<span class="subst">$&#123;post.wp_slug&#125;</span>.md`</span>));</span><br><span class="line">                    <span class="keyword">try</span> &#123;</span><br><span class="line">                        <span class="keyword">await</span> fs.writeFile(postPath, content);</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            <span class="keyword">await</span> publishToGitHub(git, path.join(<span class="string">"source"</span>, <span class="string">"_posts"</span>, <span class="string">`<span class="subst">$&#123;post.wp_slug&#125;</span>.md`</span>));</span><br><span class="line">                            callback(<span class="literal">null</span>, post.wp_slug);</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                            callback(<span class="keyword">new</span> ExpressError((error <span class="keyword">as</span> <span class="built_in">Error</span>).message, <span class="number">500</span>));</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                        callback(<span class="keyword">new</span> ExpressError(<span class="string">"Internal Server Error: Cannot write post file."</span>, <span class="number">500</span>));</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                    callback(<span class="keyword">new</span> ExpressError(<span class="string">"Internal Server Error: Cannot read scaffolds."</span>, <span class="number">500</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                callback(<span class="keyword">new</span> ExpressError(<span class="string">"Inernal Server Error: Not a hexo repo."</span>, <span class="number">500</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            callback(<span class="keyword">new</span> ExpressError(<span class="string">"Username or Password is wrong."</span>, <span class="number">500</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback(<span class="keyword">new</span> ExpressError(<span class="string">"Blog id is required."</span>, <span class="number">500</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">getPost</span>(<span class="params">postid: <span class="built_in">string</span>, username: <span class="built_in">string</span>, password: <span class="built_in">string</span>, callback: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">await</span> hexo.load()</span><br><span class="line">        <span class="keyword">let</span> posts = hexo.locals.get(<span class="string">"posts"</span>).filter(<span class="function">(<span class="params">v, i</span>) =&gt;</span> v.title === postid).toArray();</span><br><span class="line">        <span class="keyword">if</span> (posts &amp;&amp; posts.length) &#123;</span><br><span class="line">            <span class="keyword">let</span> post = posts[<span class="number">0</span>];</span><br><span class="line">            <span class="keyword">let</span> postStructure: PostContent = &#123;</span><br><span class="line">                categories: post.categories,</span><br><span class="line">                dateCreated: post.date.toDate(),</span><br><span class="line">                description: post.content,</span><br><span class="line">                title: post.title,</span><br><span class="line">                mt_keywords: post.tags.join(<span class="string">","</span>),</span><br><span class="line">                wp_slug: path.basename(post.path)</span><br><span class="line">            &#125;;</span><br><span class="line">            callback(<span class="literal">null</span>, postStructure)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        callback(<span class="keyword">new</span> ExpressError(<span class="string">"Post not found"</span>, <span class="number">500</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getCategories</span>(<span class="params">blogid: <span class="built_in">string</span>, username: <span class="built_in">string</span>, password: <span class="built_in">string</span>, callback: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">    callback(<span class="literal">null</span>, config.meta.categories.map(<span class="function">(<span class="params">item: <span class="built_in">string</span></span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> &#123;</span><br><span class="line">            categoryid: item,</span><br><span class="line">            description: item,</span><br><span class="line">            title: item</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">newMediaObject</span>(<span class="params">blogid: <span class="built_in">string</span>, username: <span class="built_in">string</span>, password: <span class="built_in">string</span>, mediaObject: MediaObject, callback: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (blogid) &#123;</span><br><span class="line">        <span class="keyword">if</span> (username.toLowerCase() === <span class="string">"hpdell"</span> &amp;&amp; md5(password) === <span class="string">"2b759a6996d878c41bb7d56ce530d031"</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> imgPath = path.join(blog, <span class="string">"source"</span>, <span class="string">"assets"</span>, <span class="string">"img"</span>, mediaObject.name);</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">await</span> fs.writeFile(imgPath, mediaObject.bits);</span><br><span class="line">                callback(<span class="literal">null</span>, &#123;</span><br><span class="line">                    url: <span class="string">"/"</span> + [<span class="string">"assets"</span>, <span class="string">"img"</span>, mediaObject.name].join(<span class="string">"/"</span>)</span><br><span class="line">                &#125;)</span><br><span class="line">            &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">                callback(<span class="keyword">new</span> ExpressError(<span class="string">"Writefile Wrong."</span>, <span class="number">500</span>));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            callback(<span class="keyword">new</span> ExpressError(<span class="string">"Username or Password is wrong."</span>, <span class="number">500</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        callback(<span class="keyword">new</span> ExpressError(<span class="string">"Blog id is required."</span>, <span class="number">500</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">publishToGitHub</span>(<span class="params">git: simplegit.SimpleGit, postPath</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> imgDirPath = path.join(<span class="string">"source"</span>, <span class="string">"assets"</span>, <span class="string">"img"</span>, <span class="string">"*"</span>);</span><br><span class="line">        <span class="keyword">await</span> git.add([postPath, imgDirPath]);</span><br><span class="line">        <span class="keyword">await</span> git.commit(<span class="string">`Add Post: <span class="subst">$&#123;path.basename(postPath)&#125;</span>`</span>);</span><br><span class="line">        <span class="keyword">await</span> git.pull(<span class="string">"origin"</span>, <span class="string">"master"</span>, &#123;</span><br><span class="line">            <span class="string">"--rebase"</span>: <span class="string">"true"</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">await</span> git.push();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">"git error"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这个实现还比较粗糙，为了简单起见， <code>getPost</code> 还是调用了 Hexo 的接口。分类部分还是用的 package.json 文件中确定的几种类型。对 blogid 也没有做判断。</p></blockquote><p><code>blogger.ts</code> 的实现方式</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getUserBlogs</span>(<span class="params">key: <span class="built_in">string</span>, username: <span class="built_in">string</span>, password: <span class="built_in">string</span>, callback: <span class="built_in">Function</span></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'getuserblogs called with key:'</span>, key, <span class="string">'username:'</span>, username, <span class="string">'and password:'</span>, password);</span><br><span class="line">    callback(<span class="literal">null</span>, [&#123; blogid: <span class="string">'hpdell-hexo'</span>, blogName: <span class="string">'HPDell 的 Hexo 博客'</span>, &#125;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>这里这个实现也是为了简单起见，直接返回了固定的名称和 ID 。</p></blockquote><p>至此，这个接口就算是基本实现了。</p><h1 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h1><p>查看 <a href="https://hpdell.github.io/">我的博客</a> 里面有两篇博文</p><ul><li>测试发布到 GitHub</li><li>测试通过 Metaweblog API 发图片</li></ul><p>即可查看效果。</p><div class="post-announce">感谢您的阅读，本文由 <a href="http://hpdell.github.io">HPDell 的个人博客</a> 版权所有。如若转载，请注明出处：HPDell 的个人博客（<a href="http://hpdell.github.io/编程/hexo-metaweblog-guide/">http://hpdell.github.io/编程/hexo-metaweblog-guide/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/其他/test-metaweblog-api/" title="测试发布到 GitHub"><i class="iconfont icon-prev"></i>测试发布到 GitHub</a></div><div class="post__prev post__prev--right"><a href="/编程/microsoft-machine-learning-server/" title="Microsoft Machine Learning Server 使用调研">Microsoft Machine Learning Server 使用调研<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">HPDell 的博客</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/随笔/">随笔</a><span class="block-list-count">9</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/编程/">编程</a><span class="block-list-count">25</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/理论/">理论</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/其他/">其他</a><span class="block-list-count">5</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/编程/cmake-cpp-pypi-cran/" title="使用 CMake 统一管理并编译 C++/Python/R 算法包"><div class="item__cover"><img src="/assets/cover/cmake-python-r-cover.png" alt="使用 CMake 统一管理并编译 C++/Python/R 算法包"></div><div class="item__info"><h3 class="item__title">使用 CMake 统一管理并编译 C++/Python/R 算法包</h3><span class="item__text">2022-04-14</span></div></a></li><li class="latest-post-item"><a href="/理论/genshin-impact-critical/" title="原神中为什么暴击暴伤比为1:2最好？"><div class="item__cover"><img src="/assets/cover/genshin-impact-critical.jpg" alt="原神中为什么暴击暴伤比为1:2最好？"></div><div class="item__info"><h3 class="item__title">原神中为什么暴击暴伤比为1:2最好？</h3><span class="item__text">2022-03-25</span></div></a></li><li class="latest-post-item"><a href="/编程/dynamic-blog-v2/" title="自己动手写动态博客（二）"><div class="item__cover"><img src="/assets/cover/dynamic-blog-v2.png" alt="自己动手写动态博客（二）"></div><div class="item__info"><h3 class="item__title">自己动手写动态博客（二）</h3><span class="item__text">2022-03-20</span></div></a></li><li class="latest-post-item"><a href="/编程/windows-cmd-mklink/" title="Windows 创建符号链接的命令 mklink"><div class="item__cover"><img src="/assets/img/header_cover.jpg" alt="Windows 创建符号链接的命令 mklink"></div><div class="item__info"><h3 class="item__title">Windows 创建符号链接的命令 mklink</h3><span class="item__text">2022-01-19</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/Apache-POI/">Apache POI</a></li><li class="tag-item"><a class="tag-link" href="/tags/Bootstrap/">Bootstrap</a></li><li class="tag-item"><a class="tag-link" href="/tags/C/">C#</a></li><li class="tag-item"><a class="tag-link" href="/tags/C/">C++</a></li><li class="tag-item"><a class="tag-link" href="/tags/CMake/">CMake</a></li><li class="tag-item"><a class="tag-link" href="/tags/CUDA/">CUDA</a></li><li class="tag-item"><a class="tag-link" href="/tags/Cython/">Cython</a></li><li class="tag-item"><a class="tag-link" href="/tags/Django/">Django</a></li><li class="tag-item"><a class="tag-link" href="/tags/GitLab-Runner/">GitLab Runner</a></li><li class="tag-item"><a class="tag-link" href="/tags/LaTeX/">LaTeX</a></li><li class="tag-item"><a class="tag-link" href="/tags/Linux/">Linux</a></li><li class="tag-item"><a class="tag-link" href="/tags/Node-js/">Node.js</a></li><li class="tag-item"><a class="tag-link" href="/tags/Python/">Python</a></li><li class="tag-item"><a class="tag-link" href="/tags/QGIS/">QGIS</a></li><li class="tag-item"><a class="tag-link" href="/tags/Qt/">Qt</a></li><li class="tag-item"><a class="tag-link" href="/tags/R/">R</a></li><li class="tag-item"><a class="tag-link" href="/tags/TypeScript/">TypeScript</a></li><li class="tag-item"><a class="tag-link" href="/tags/Vue/">Vue</a></li><li class="tag-item"><a class="tag-link" href="/tags/WPF/">WPF</a></li><li class="tag-item"><a class="tag-link" href="/tags/Windows/">Windows</a></li><li class="tag-item"><a class="tag-link" href="/tags/XAML/">XAML</a></li><li class="tag-item"><a class="tag-link" href="/tags/jQuery-Mobile/">jQuery Mobile</a></li><li class="tag-item"><a class="tag-link" href="/tags/travis/">travis</a></li><li class="tag-item"><a class="tag-link" href="/tags/博客相关/">博客相关</a></li><li class="tag-item"><a class="tag-link" href="/tags/原神/">原神</a></li><li class="tag-item"><a class="tag-link" href="/tags/哈利波特/">哈利波特</a></li><li class="tag-item"><a class="tag-link" href="/tags/影评/">影评</a></li><li class="tag-item"><a class="tag-link" href="/tags/测试/">测试</a></li><li class="tag-item"><a class="tag-link" href="/tags/爬虫/">爬虫</a></li><li class="tag-item"><a class="tag-link" href="/tags/电影/">电影</a></li><li class="tag-item"><a class="tag-link" href="/tags/统计学/">统计学</a></li><li class="tag-item"><a class="tag-link" href="/tags/网页开发/">网页开发</a></li><li class="tag-item"><a class="tag-link" href="/tags/课程/">课程</a></li><li class="tag-item"><a class="tag-link" href="/tags/路网速度/">路网速度</a></li><li class="tag-item"><a class="tag-link" href="/tags/随笔/">随笔</a></li></ul></div><div class="sidebar__block__sticky"><h3 class="block__title">目录</h3><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Hexo-搭建静态博客的问题"><span class="toc-text">Hexo 搭建静态博客的问题</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#依赖库"><span class="toc-text">依赖库</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#主要接口"><span class="toc-text">主要接口</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Metaweblog-API"><span class="toc-text">Metaweblog API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Blogger-API"><span class="toc-text">Blogger API</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#基于-express-和-xrpc-库的实现方式"><span class="toc-text">基于 express 和 xrpc 库的实现方式</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#效果"><span class="toc-text">效果</span></a></li></ol></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">HPDell的博客，基于Hexo。分享生活，分享技术，分享观点，为自己留下感动。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Wuhan University, Luoyu Road, Wuhan, Hubei, China.</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>huyg0180110559@outlook.com</span></li></ul></div></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="https://blog.huyg.site:8443/" title="我的动态博客" target="_blank">我的动态博客</a></li><li class="list-item"><a href="https://hkvision.cn/" title="HaoKunT的博客" target="_blank">HaoKunT的博客</a></li><li class="list-item"><a href="https://home.cs-tao.cc/" title="这是一个不能停留太久的世界" target="_blank">CS-Tao</a></li><li class="list-item"><a href="http://gwmodel.whu.edu.cn/#/" title="地理加权建模实验室" target="_blank">GWmodel-Lab</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>.</p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/HPDell" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:huyg0180110559@outlook.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li><li class="social-network__item"><a href="https://www.zhihu.com/people/hu-yi-gong-63/activities" target="_blank" title="知乎"><i class="iconfont icon-zhihu"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["TypeScript","Node.js","博客相关"],gitalk=new Gitalk({clientID:"47d3a0c03f3c07172ecc",clientSecret:"8e0da02c5e757c77b93627a7e380e43a248d001c",repo:"HPDell.github.io",owner:"HPDell",admin:["HPDell"],labels:tags,id:new Date(1551197368e3).getTime()>new Date("2018-02-15").getTime()?md5(encodeURI(decodeURI(location.href))):location.href});gitalk.render("comment-container")</script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script><script>!function(n){var o=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(t,e){var n=new Image,o=t.getAttribute("data-original");n.onload=function(){t.src=o,e&&e()},n.src=o}function c(){for(var t=0;t<o.length;t++)0<=(e=o[t].getBoundingClientRect()).top&&0<=e.left&&e.top<=(n.innerHeight||document.documentElement.clientHeight)&&i(o[t],function(){o.splice(t,t)});var e;console.log("trigger")}c(),n.addEventListener("scroll",function(){var t,e;t=c,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script></body></html>